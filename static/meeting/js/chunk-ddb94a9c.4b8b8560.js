(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ddb94a9c"],{"0b9d":function(e,t,r){},"34b2":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"create_demand box"},[r("div",{staticClass:"path"},[r("ul",[r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.$router.replace({path:"/DMCeventlist"})}}},[e._v("我的会议")]),e.$route.query.type?r("li",{staticStyle:{color:"#7c7f82"}},[e._v(">")]):e._e(),e.$route.query.type?r("li",{staticStyle:{color:"#409EFF",cursor:"pointer"},on:{click:function(t){return e.$router.replace({path:"/DMCEventDetail?id="+e.$route.query.id+"&name="+e.$route.query.name+"&eventSearchType="+e.$route.query.eventSearchType})}}},[e._v("会议详情 ("+e._s(e.$route.query.name)+")")]):e._e(),r("li",{staticStyle:{color:"#7c7f82"}},[e._v(">")]),e.$route.query.type?r("li",{staticStyle:{color:"#409EFF",cursor:"pointer"},on:{click:function(t){return e.$router.replace({path:"/DMCcreateEvent?id="+e.$route.query.id+"&name="+e.$route.query.name+"&eventSearchType="+e.$route.query.eventSearchType+"&type="+e.$route.query.type})}}},[e._v("创建会议")]):e._e(),r("li",{staticStyle:{color:"#7c7f82"}},[e._v(">")]),r("li",{staticStyle:{color:"#7c7f82"}},[e._v("采购需求")])],1)]),e.isCheck?e._e():r("div",{staticClass:"edit_base_info"},[e._v(" 已根据会议基本信息的会议时间自动匹配好需求可选日期，若有误请您先 "),r("span",{on:{click:e.goEdit}},[e._v("修改会议基本信息>")])]),r("div",{staticClass:"demand_title"}),r("div",{staticClass:"guestRoom_demand"},[e._m(0),e.dateArr.length?r("room",{ref:"room",attrs:{dateArr:e.roomDate,outDate:e.outDate,isDMC:!0}}):e._e(),e.dateArr.length?r("event",{ref:"event",attrs:{dateArr:e.dateArr,swingList:e.swingList,isDMC:!0}}):e._e(),e.dateArr.length?r("foodDemand",{ref:"food",attrs:{dateArr:e.allDate,foodList:e.foodList,isDMC:!0}}):e._e(),e.dateArr.length?r("foodOutDemand",{ref:"foodOut",attrs:{dateArr:e.allDate,foodList:e.foodList,isDMC:!0}}):e._e(),e.dateArr.length?r("intercity",{ref:"intercity",attrs:{dateArr:e.allDate,trafficType:e.trafficType,isDMC:!0}}):e._e(),e.dateArr.length?r("car",{ref:"car",attrs:{carType:e.carType,dateArr:e.allDate,purposeList:e.purposeList,isDMC:!0}}):e._e(),r("other",{ref:"other",attrs:{isDMC:!0}})],1),r("div",{staticClass:"flex_row justify_center mar_b20 sub_part"},[e.isCheck?e._e():r("el-button",{staticClass:"sub_btn",attrs:{type:"primary"},on:{click:e.subTap}},[e._v("保存")]),e.isCheck?r("el-button",{staticClass:"sub_btn",attrs:{type:"cancel"},on:{click:e.backPrePage}},[e._v("返回")]):e._e()],1),r("el-dialog",{attrs:{title:"保存成功",visible:e.nextDialog,align:"center",top:"200px"},on:{"update:visible":function(t){e.nextDialog=t}}},[r("el-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:e.tableData,fit:"","show-header":!1,"tooltip-effect":"dark"},on:{"row-click":e.checkedRow,"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection"}}),r("el-table-column",{attrs:{label:"询价单"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" 询价单号【"+e._s(t.row.inquiry_sheet_code)+"】 ")]}}])}),r("el-table-column",{attrs:{prop:"company_name",label:"公司","show-overflow-tooltip":""}}),r("el-table-column",{attrs:{prop:"total_amount",label:"金额",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticStyle:{color:"#f91"}},[e._v("￥"+e._s(e.positiveFloat(t.row.total_amount)))])]}}])}),r("el-table-column",{attrs:{prop:"name",width:"100",label:"状态","show-overflow-tooltip":""}})],1),r("el-button",{staticClass:"mar_lr20",attrs:{size:"small",type:"primary"},on:{click:function(t){return e.goNext(1)}}},[e._v("生成新询价单，立即报价")]),r("el-button",{staticClass:"mar_lr20",attrs:{size:"small",type:"primary"},on:{click:function(t){return e.goNext(2)}}},[e._v("更新询价单，更新报价")]),r("el-button",{attrs:{size:"small"},on:{click:function(t){return e.goNext(5)}}},[e._v("返回会议详情")])],1),r("el-dialog",{attrs:{visible:e.isDemandHotel,width:"30%",align:"center"},on:{"update:visible":function(t){e.isDemandHotel=t}}},[r("span",[e._v("请选择会议服务商进行采购的方式")]),r("span",{staticClass:"dialog-footer flex_row justify_center",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.goNext(3)}}},[e._v("立即采购(不含酒店)")]),r("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.goNext(4)}}},[e._v("立即采购(含酒店)")])],1)]),r("el-dialog",{attrs:{title:"请完善信息",visible:e.perfectDialog,align:"left",top:"200px"},on:{"update:visible":function(t){e.perfectDialog=t}}},[r("p",{staticStyle:{"font-size":"16px","line-height":"20px"},domProps:{innerHTML:e._s(e.perfectMsg)}})])],1)},i=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"demand_item_title"},[r("span",[e._v("填写会议采购需求")]),e._v("Event Requirements ")])}],n=r("5530"),s=r("2909"),a=(r("4de4"),r("d3b7"),r("99af"),r("159b"),r("e9c4"),r("a9e3"),r("ac1f"),r("5319"),r("25f0"),r("b0c0"),r("6813")),c=r("2905"),u=r("e99c"),d=r("e885"),_=r("a365"),f=r("6dd6"),h=r("e45d"),l=r("cf45"),p=r("2654"),m={name:"EventDemand",data:function(){return{isDemandHotel:!1,eventId:"",eventName:"",tableData:[],hasCheckedRow:!1,dateArr:[],allDate:[],roomDate:[],outDate:[],demandList:[],swingList:[],equipmentList:[],foodList:[],trafficType:[],purposeList:[],carType:[],otherService:[],nextDialog:!1,perfectDialog:!1,perfectMsg:"",purchaseId:"",isShowHotelBtn:0,isCheck:!1,InquirySheetObjectID:""}},components:{room:a["a"],event:c["a"],intercity:u["a"],foodDemand:d["a"],foodOutDemand:_["a"],car:f["a"],other:h["a"]},mounted:function(){var e=this;this.eventId=this.$route.query.id,this.getDemandList().then((function(t){var r=[],o=t.BeginTime.substring(0,10),i=Object(l["h"])(o,-1),n=Object(l["h"])(o,-2),a=Object(l["h"])(o,-3),c=Object(l["h"])(e.dateArr[e.dateArr.length-1],1),u=Object(l["h"])(e.dateArr[e.dateArr.length-1],2),d=Object(l["h"])(e.dateArr[e.dateArr.length-1],3);e.roomDate=[a,n,i].concat(Object(s["a"])(e.dateArr),[c]).filter((function(e){return e})),e.outDate=[a,n,i].concat(Object(s["a"])(e.dateArr),[c,u]).filter((function(e){return e})),e.allDate=[a,n,i].concat(Object(s["a"])(e.dateArr),[c,u,d]).filter((function(e){return e})),e.roomDate.forEach((function(e){var t={id:"",check_in_date:e,twin_bed_count:"",king_bed_count:"",superior_room_count:"",other_requirements:"",is_delete:0};r.push(t)})),e.$refs.event.meetDate=e.dateArr,e.$refs.intercity.interDate=e.allDate,e.$refs.intercity.eventEndTime=e.demandList.EndTime.substring(0,10),e.$refs.car.carDate=e.allDate,e.$refs.room.room=JSON.parse(JSON.stringify(r)),e.$refs.room.orgRoom=JSON.parse(JSON.stringify(r)),e.swingList=e.demandList.Tower,e.$refs.foodOut.FoodOutside=e.demandList.FoodOutside,e.$refs.foodOut.dateArr=e.allDate,e.$refs.food.dateArr=e.allDate;var _=e.demandList.Equipment;e.equipmentList=_,e.$refs.event.conferenceList[0].conference[0].equipment=JSON.parse(JSON.stringify(_)),e.$refs.event.tagList=JSON.parse(JSON.stringify(_)),e.foodList=e.demandList.Food,e.$refs.intercity.trafficType=e.demandList.Car,e.$refs.intercity.init(),e.purposeList=e.demandList.Purpose,e.carType=e.demandList.CarType;var f=e.demandList.OtherService;f.forEach((function(e){e.is_delete=1})),e.$refs.other.otherList=JSON.parse(JSON.stringify(f));var h=e.$route.query;h&&h.type&&"check"===h.type&&(e.isCheck=!0),e.getDemandDetail()}))},methods:{positiveFloat:l["m"],checkedRow:function(e,t,r){1==e.state&&this.$refs.multipleTable.toggleRowSelection(e,!0)},handleSelectionChange:function(e){e.length>0&&(this.hasCheckedRow=!0),this.InquirySheetObjectID=e[0].id},subTap:function(){var e=this,t=this.$refs.room.room,r=this.$refs.event.conferenceList,o=[];r.forEach((function(e){e.conference.forEach((function(t){o.push(Object(n["a"])(Object(n["a"])({},t),{},{conference_date:e.conference_date}))}))}));this.$refs.food.foodBudgetList;var i=this.$refs.intercity.transportationList,s=[];i.forEach((function(e){e.transportation.forEach((function(t){s.push(Object(n["a"])(Object(n["a"])({},t),{},{transportation_date:e.transportation_date.substring(0,10)}))}))}));var a=this.$refs.car.carList,c=[];a.forEach((function(e){e.car.forEach((function(t){c.push(Object(n["a"])(Object(n["a"])({},t),{},{car_date:e.car_date}))}))}));var u=this.$refs.other.otherAddList;console.log(JSON.stringify(u));var d=this.$refs.other.otherCustom,_={is_guest_room:this.$refs.room.is_guest_room,guest_room_budget:Number(this.$refs.room.guest_room_budget),check_in_date:this.$refs.room.check_in_date,out_date:this.$refs.room.out_date,night_budget:Number(this.$refs.room.night_budget),is_networks:this.$refs.room.is_networks?1:0,is_breakfast:this.$refs.room.is_breakfast?1:0,is_Inside_outside:this.$refs.room.is_Inside_outside,is_conference_rooms:this.$refs.event.is_conference_rooms,conference_rooms_budget:Number(this.$refs.event.conference_rooms_budget),is_food_beverage:this.$refs.food.is_food_beverage,food_beverage_budget:Number(this.$refs.food.food_beverage_budget),is_food_outside:this.$refs.foodOut.is_food_outside,food_outside_budget:Number(this.$refs.foodOut.food_outside_budget),is_intercity_transportation:this.$refs.intercity.is_intercity_transportation,intercity_transportation_budget:Number(this.$refs.intercity.intercity_transportation_budget),is_car_rental:this.$refs.car.is_car_rental,car_rental_budget:Number(this.$refs.car.car_rental_budget),is_other:1,other_budget:Number(this.$refs.other.other_budget),order_describe:this.$refs.other.order_describe,is_delete:"0",id:this.purchaseId,event_info_id:this.eventId},f={meetingid:this.eventId,meeting_type:1,purchase:_,room:"1"==this.$refs.room.is_guest_room?t:[],other:u,otherCustom:d,car:"1"==this.$refs.car.is_car_rental?c:[],transportation:"1"==this.$refs.intercity.is_intercity_transportation?s:[],food:"1"==this.$refs.food.is_food_beverage?this.$refs.food.foodBudgetList:[],foodOutside:"1"==this.$refs.foodOut.is_food_outside?this.$refs.foodOut.foodBudgetList:[],conference:"1"==this.$refs.event.is_conference_rooms?r:[]},h="",l="",p="",m="";if(f.conference.forEach((function(e,t){e.index=t+1})),f.room.forEach((function(t,r){if("1"==e.$refs.room.is_Inside_outside){var o=parseFloat(t.in_twin_bed_count)?parseFloat(t.in_twin_bed_count):0,i=parseFloat(t.out_twin_bed_count)?parseFloat(t.out_twin_bed_count):0;t.twin_bed_count=o+i;var n=parseFloat(t.in_king_bed_count)?parseFloat(t.in_king_bed_count):0,s=parseFloat(t.out_king_bed_count)?parseFloat(t.out_king_bed_count):0;t.king_bed_count=n+s;var a=parseFloat(t.in_superior_room_count)?parseFloat(t.in_superior_room_count):0,c=parseFloat(t.out_superior_room_count)?parseFloat(t.out_superior_room_count):0;t.superior_room_count=a+c}"0"==e.$refs.room.is_Inside_outside&&(t.in_twin_bed_count=0,t.out_twin_bed_count=t.twin_bed_count,t.in_king_bed_count=0,t.out_king_bed_count=t.king_bed_count,t.in_superior_room_count=0,t.out_superior_room_count=t.superior_room_count),t.index=r+1})),f.food.forEach((function(e,t){e.index=t+1})),f.foodOutside.forEach((function(e,t){e.index=t+1})),f.conference.forEach((function(e){e.conference.forEach((function(t){t.conference_start_time&&t.conference_end_time&&t.attendees&&t.room_setup_type&&(1!==t.is_setting_in_advance||t.setting_in_advance_date&&t.rehearsal_date)||(h+="<b>"+e.conference_date+"</b>会场需求 ",t.conference_start_time||(h+=" 会场开始时间未填写 "),t.conference_end_time||(h+=" 会场结束时间未填写 "),t.attendees||(h+=" 参与人数未填写 "),t.room_setup_type||(h+=" 摆台形式未填写 "),1===t.is_setting_in_advance&&(t.setting_in_advance_date||(h+=" 搭建入场时间未填写 "),t.rehearsal_date||(h+=" 彩排完成时间未填写 ")))}))})),f.transportation.forEach((function(e,t){e.origin_city&&e.destination_city&&e.passenger_count&&e.trans_type||(l+="<br/><b>"+e.transportation_date+"</b>大交通需求 ",e.origin_city||(l+=" 始发地未填写 "),e.destination_city||(l+=" 目的地未填写 "),e.passenger_count||(l+=" 搭乘人数未填写 "),e.trans_type||(l+=" 交通工具未填写 ")),e.index=t+1})),f.car.forEach((function(e,t){e.purpose&&e.vehicle_type&&e.car_count||(p+="<br/><b>"+e.car_date+"</b>地面交通需求 ",e.purpose||(p+=" 用车目的未填写 "),e.vehicle_type||(p+=" 用车类型未填写 "),e.car_count||(p+=" 用车数量未填写 ")),e.index=t+1})),f.other.some((function(e,t){1===e.type||e.participate_count||(m+="<br/>其他需求-"+e.order_name+" 数量未填写"),1!==e.type||e.describe||(m+="<br/>其他需求-"+e.order_name+" 需求描述未填写"),e.index=t+1})),f.otherCustom.some((function(e,t){e.describe||(m+="<br/>其他需求 描述未填写"),e.index=f.other.length+t+1})),m||h||l||p)return this.perfectDialog=!0,void(this.perfectMsg=h+l+p+m);this.$api.addPurchase({Parameter:JSON.stringify(f)},"POST").then((function(t){t&&(e.$message.success("保存成功"),e.getHotelBtn(),e.GetEditInquirySheet(),e.nextDialog=!0)}))},GetEditInquirySheet:function(){var e=this;this.$api.GetEditInquirySheet({MeetingID:this.eventId},"POST").then((function(t){e.tableData=t}))},getHotelBtn:function(){var e=this;this.$api.getPurchase({MeetingID:this.eventId},"POST").then((function(t){e.isShowHotelBtn=t.type}))},goNext:function(e){var t=this;localStorage.getItem("event_city_code");if(1===e)this.$api.CreateInquirySheet({MeetingID:this.eventId},"POST").then((function(e){e&&t.$router.push({name:"DMCactivityOrderInfo",params:{id:e}})}));else if(2==e){if(!this.hasCheckedRow)return void this.$message.error("请选择中要更新的询价单");this.$api.UpdateInquirySheet({MeetingID:this.eventId,InquirySheetObjectID:this.InquirySheetObjectID},"POST").then((function(e){e&&t.$router.push({name:"DMCactivityOrderInfo",params:{id:t.InquirySheetObjectID}})}))}else 5===e&&this.$router.replace({path:"/DMCEventDetail",query:{id:this.eventId}})},getDemandDetail:function(){var e=this;this.$api.getDemandDetail({MeetingID:this.eventId},"post").then((function(t){if(t){if(t.room&&t.room.length&&(e.$refs.room.room=t.room),t.purchase&&(e.purchaseId=t.purchase.id,e.$refs.room.night_budget=t.purchase.night_budget,e.$refs.room.check_in_date=t.purchase.check_in_date.substring(0,10),e.$refs.room.is_guest_room=t.purchase.is_guest_room.toString(),e.$refs.room.guest_room_budget=t.purchase.guest_room_budget,e.$refs.room.out_date=t.purchase.out_date,e.$refs.room.is_breakfast=1==t.purchase.is_breakfast,e.$refs.room.is_networks=1==t.purchase.is_networks,e.$refs.room.is_Inside_outside=t.purchase.is_inside_outside?t.purchase.is_inside_outside:0),t.conference&&t.conference.length){var r=Object(p["d"])(t.conference,"conference_date");r.forEach((function(t){t.conference_date=t.time.substring(0,10),t.conference=t.data,t.conference.forEach((function(t){t.equipment.forEach((function(t){var r=e.equipmentList.filter((function(e){return e.equipment_code===t.equipment_code}));t.value=r.length?r[0].value:""}))}))})),e.$refs.event.conferenceList=JSON.parse(JSON.stringify(r)),e.$refs.event.addDate()}if(e.$refs.event.is_conference_rooms=t.purchase.is_conference_rooms.toString(),e.$refs.event.conference_rooms_budget=t.purchase.conference_rooms_budget,t.food&&t.food.length&&(e.$refs.food.foodBudgetList=t.food),e.$refs.food.is_food_beverage=t.purchase.is_food_beverage.toString(),e.$refs.food.food_beverage_budget=t.purchase.food_beverage_budget,e.$refs.food.food_limit=t.purchase.food_limit,t.foodOutside&&t.foodOutside.length&&(e.$refs.foodOut.foodBudgetList=t.foodOutside),e.$refs.foodOut.is_food_outside=t.purchase.is_food_outside.toString(),e.$refs.foodOut.food_outside_budget=t.purchase.food_outside_budget,e.$refs.foodOut.food_limit=t.purchase.food_limit,t.transportation&&t.transportation.length){e.$refs.intercity.transportationList=[];var o=t.transportation;o.forEach((function(e){e.transportation_date=e.transportation_date.substring(0,10)})),e.$refs.intercity.transportationList=o}e.$refs.intercity.is_intercity_transportation=t.purchase.is_intercity_transportation.toString(),e.$refs.intercity.intercity_transportation_budget=t.purchase.intercity_transportation_budget,t.car&&t.car.length&&(e.$refs.car.carList=Object(p["c"])(t.car,"car_date")),e.$refs.car.is_car_rental=t.purchase.is_car_rental.toString(),e.$refs.car.car_rental_budget=t.purchase.car_rental_budget,e.$refs.car.eventCity=t.purchase.cityname,e.$refs.other.other_budget=t.purchase.other_budget,e.$refs.other.otherAddList=t.other,e.$refs.other.otherCustom=t.otherCustom,e.$refs.other.order_describe=t.purchase.order_describe}}))},getDemandList:function(){var e=this;return new Promise((function(t,r){e.$api.servicePurchase({MeetingID:e.eventId},"POST").then((function(r){e.demandList=r,e.dateArr=Object(l["f"])(e.demandList.BeginTime.substring(0,10),e.demandList.EndTime.substring(0,10)),e.$forceUpdate(),t(r)}))}))},goEdit:function(){this.$router.replace({path:"/DMCcreateEvent",query:{id:this.eventId,type:"edit"}})},backPrePage:function(){this.$router.replace({path:"/DMCEventDetail",query:{id:this.eventId,name:this.$route.query.name,eventSearchType:this.$route.query.eventSearchType}})}}},g=m,b=(r("8ca9"),r("2877")),v=Object(b["a"])(g,o,i,!1,null,null,null);t["default"]=v.exports},"8ca9":function(e,t,r){"use strict";r("0b9d")}}]);