(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-08a422fa"],{3160:function(t,e,s){"use strict";s("d4df")},6941:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return t.info?e("div",{staticClass:"orderInfo"},[e("div",{staticClass:"title"},[t._v(" 我的订单 - 结算单 - "),t.info?[t._v(" "+t._s(t.info.num)+" ")]:t._e()],2),e("a",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"a_click",attrs:{href:t.downloadUrl,target:"_blank",download:""}}),t.info?e("div",{staticClass:"content"},[t.info.settlement_status===t.status_draft?e("div",{staticClass:"tips"},[e("p",[t._v("该草稿保存于"+t._s(t.info.settlement_submit_time))])]):t._e(),e("div",{staticClass:"step"},[t._v(" Step1 确认订单基本信息 "),e("p",{staticStyle:{color:"#428bca","font-size":"17px",float:"right"}},[0==this.$route.params.issubmit?e("a",{staticStyle:{cursor:"pointer",margin:"0 10px"},attrs:{download:""},on:{click:t.excelDownload}},[t._v("下载结算Excel")]):t._e()])]),e("div",{staticClass:"info"},[e("div",{staticClass:"line"},[e("div",{staticClass:"item"},[e("div",{staticClass:"label"},[t._v("订单号")]),e("div",{staticClass:"context"},[t._v(t._s(t.info.num))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"label"},[t._v("联系人")]),e("div",{staticClass:"context"},[t._v(t._s(t.info.contacts))])])]),e("div",{staticClass:"line"},[e("div",{staticClass:"item"},[e("div",{staticClass:"label"},[t._v("下单时间")]),e("div",{staticClass:"context"},[t._v(t._s(t._f("date_ex")(t.info.submit_time)))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"label"},[t._v("联系方式")]),e("div",{staticClass:"context"},[t._v(t._s(t.info.customer_service_telephone_numbers))])])]),e("div",{staticClass:"line"},[e("div",{staticClass:"item"},[e("div",{staticClass:"label"},[t._v("活动名称")]),e("div",{staticClass:"context"},[t._v(t._s(t.info.activity_name))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"label"},[t._v("客户名称")]),e("div",{staticClass:"context"},[t._v(t._s(t.info.company_name))])])]),e("div",{staticClass:"line"},[e("div",{staticClass:"item"},[e("div",{staticClass:"label"},[t._v("活动日期")]),e("div",{staticClass:"context"},[t._v(t._s(t.info.activity_date))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"label"},[t._v("报价日期")]),e("div",{staticClass:"context"},[t._v(t._s(t._f("date_ex")(t.info.offer_data)))])])])]),e("div",{staticClass:"step"},[t._v("Step2 上传结算相关凭证（必填）")]),e("table",[t._m(0),t._l(t.arrayList,(function(s,i){return e("tbody",[4!=i?e("tr",[e("td",[t._v(t._s(s.name))]),e("td",[e("el-upload",{ref:"upload",refInFor:!0,attrs:{action:"","on-change":(e,i)=>{t.handleChangeAttach(e,i,t.type=s.type)},"on-remove":(e,i)=>{t.handleRemoveAttach(e,i,t.type=s.type)},"on-preview":t.handlePreview,"auto-upload":!1,"file-list":s.fileList,"show-file-list":!1,multiple:!1,disabled:t.isconfirm}},[!t.isconfirm||t.issupplement?e("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("从电脑选择文件")]):t._e(),e("ul",{staticStyle:{"margin-top":"5px"}},t._l(s.fileList,(function(s,o){return e("li",{key:o,staticClass:"pitchOn",on:{click:function(e){return t.handlePreview(s)}}},[e("span",[t._v(t._s(s.name))]),e("span",{staticStyle:{color:"#199ED8",cursor:"pointer","margin-left":"30px"},on:{click:function(e){return e.stopPropagation(),t.fileRename(s,i,o)}}},[t._v("重命名")]),e("span",{staticStyle:{color:"#199ED8",cursor:"pointer","margin-left":"10px"},on:{click:function(e){return e.stopPropagation(),t.deleteFile(s,i,o)}}},[t._v("删除")])])})),0)],1),e("el-dialog",{attrs:{"close-on-click-modal":!1,visible:t.rename,title:"请输入附件名称",width:"500px"},on:{"update:visible":function(e){t.rename=e}}},[e("el-input",{attrs:{placeholder:"请输入名称"},model:{value:t.fileName,callback:function(e){t.fileName=e},expression:"fileName"}},[e("template",{slot:"append"},[t._v(" "+t._s(t.suffix)+" ")])],2),e("span",{staticClass:"dialog-footer flex_row justify_center mar_t20",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.saveFileName()}}},[t._v("保存")])],1)],1)],1),e("td",[t._v(t._s(s.dissent))]),e("td",[e("el-input",{attrs:{readonly:t.isconfirm},model:{value:s.remark,callback:function(e){t.$set(s,"remark",e)},expression:"item.remark"}})],1)]):t._e(),t.isconfirm&&4==i?e("tr",[e("td",[t._v(t._s(s.name))]),e("td",[e("el-upload",{ref:"upload",refInFor:!0,attrs:{action:"","on-change":(e,i)=>{t.handleChangeAttach(e,i,t.type=s.type)},"on-remove":(e,i)=>{t.handleRemoveAttach(e,i,t.type=s.type)},"on-preview":t.handlePreview,"auto-upload":!1,"file-list":s.fileList,"show-file-list":!1,multiple:!1,disabled:!t.isconfirm}},[t.isconfirm?e("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("从电脑选择文件")]):t._e(),e("ul",{staticStyle:{"margin-top":"5px"}},t._l(s.fileList,(function(s,o){return e("li",{key:o,staticClass:"pitchOn",on:{click:function(e){return t.handlePreview(s)}}},[e("span",[t._v(t._s(s.name))]),e("span",{staticStyle:{color:"#199ED8",cursor:"pointer","margin-left":"30px"},on:{click:function(e){return e.stopPropagation(),t.fileRename(s,i,o)}}},[t._v("重命名")]),e("span",{staticStyle:{color:"#199ED8",cursor:"pointer","margin-left":"10px"},on:{click:function(e){return e.stopPropagation(),t.deleteFile(s,i,o)}}},[t._v("删除")])])})),0)],1),e("el-dialog",{attrs:{"close-on-click-modal":!1,visible:t.rename,title:"请输入附件名称",width:"500px"},on:{"update:visible":function(e){t.rename=e}}},[e("el-input",{attrs:{placeholder:"请输入名称"},model:{value:t.fileName,callback:function(e){t.fileName=e},expression:"fileName"}},[e("template",{slot:"append"},[t._v(" "+t._s(t.suffix)+" ")])],2),e("span",{staticClass:"dialog-footer flex_row justify_center mar_t20",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.saveFileName()}}},[t._v("保存")])],1)],1)],1),e("td",[t._v(t._s(s.dissent))]),e("td",[e("el-input",{attrs:{readonly:t.readonly},model:{value:s.remark,callback:function(e){t.$set(s,"remark",e)},expression:"item.remark"}})],1)]):t._e()])}))],2),e("div",{staticClass:"step"},[t._v("Step3 填写结算明细（必填）")]),e("table",[e("thead",[e("tr",{staticClass:"color_2"},[e("th",{staticClass:"color_3",attrs:{colspan:"4"}},[t._v("原订单总报价：¥"+t._s(t.positiveFloat(t.price_no[0])))]),e("th",{staticStyle:{position:"relative"},attrs:{colspan:"5"}},[t._v("订单总结算价：¥"+t._s(t.positiveFloat(t.price_no[1]))+" "),t.readonly?t._e():e("div",{staticClass:"add_settle"},[e("el-button",{staticClass:"el-icon-folder-add",attrs:{type:"primary",size:"mini"},on:{click:t.openAddSettle}},[t._v("添加结算项目")])],1)])])]),t.roomVisible?e("tbody",[e("tr",{staticClass:"color_2"},[t._m(1),e("th",{staticClass:"color_3",staticStyle:{"text-align":"right"},attrs:{colspan:"3"}},[t._v(" 报价金额：¥"+t._s(t.positiveFloat(t.roomPrice[0].all*t.roomOut))+" "),e("p",{staticStyle:{color:"#999"}},[t._v(t._s(t.roomOutMsg))])]),e("th",{staticStyle:{"text-align":"right"},attrs:{colspan:"4"}},[t._v(" 结算金额：¥"+t._s(t.positiveFloat(t.roomPrice[1].all*t.roomSettlementOut))+" "),e("el-select",{attrs:{disabled:t.readonly,size:"mini",placeholder:"请选择"},on:{change:function(e){return t.roomVat(e)}},model:{value:t.info.settlement_roomtaxid,callback:function(e){t.$set(t.info,"settlement_roomtaxid",e)},expression:"info.settlement_roomtaxid"}},t._l(t.info.taxlist,(function(t){return e("el-option",{key:t.id,attrs:{label:t.taxname,value:t.id}})})),1)],1),e("th")])]):t._e(),t._l(t.info.settlement_sheet_room,(function(s,i){return e("tbody",{key:"kefang"+i},[e("tr",{staticClass:"color_2"},[e("th",{staticClass:"color_3"},[e("i",[t._v(t._s(t._f("date_day_ex")(s.date)))])]),e("th",{staticClass:"color_3",staticStyle:{"text-align":"right"},attrs:{colspan:"3"}},[t._v("小计：¥"+t._s(t.positiveFloat(t.roomPrice[0].subtotal["sub_"+i]*t.roomOut)))]),e("th",{staticStyle:{"text-align":"right"},attrs:{colspan:"4"}},[t._v("小计：¥"+t._s(t.positiveFloat(t.roomPrice[1].subtotal["sub_"+i]*t.roomSettlementOut)))]),e("th",[t.issubmit?e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addroom(s)}}},[t._v("添加客房")]):t._e()],1)]),e("tr",{staticClass:"color_2"},[e("th",{staticClass:"color_3"},[t._v("消费项目")]),e("th",{staticClass:"color_3"},[t._v("单价(元)")]),e("th",{staticClass:"color_3"},[t._v("数量")]),e("th",{staticClass:"color_3"},[t._v("金额(元)")]),e("th",[t._v("单价(元)")]),"0"==t.info.is_Inside_outside?e("th",[t._v("数量")]):t._e(),"1"==t.info.is_Inside_outside?e("th",[t._v("内部间数 外部间数")]):t._e(),e("th",[t._v("金额(元)")]),e("th",[t._v("客户异议")]),e("th",[t._v("结算说明")])]),t._l(s.room_list,(function(i,o){return e("tr",{key:"room"+o,class:{difference:i.difference}},[e("td",{staticClass:"color_2"},[i.quoted_price_room_id?[t._v(" "+t._s(i.roomtypename)+" ")]:[e("el-select",{attrs:{loading:t.cost_project_load,size:"small",filterable:""},on:{change:function(e){return t.changekefang(e,i)}},model:{value:i.settlement_itemid,callback:function(e){t.$set(i,"settlement_itemid",e)},expression:"room.settlement_itemid"}},t._l(t.roomcostProjects,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],i.quoted_price_room_id&&(i.otherrequirements||i.remarks)?e("el-tooltip",{staticClass:"describe-tooltip",attrs:{effect:"dark",placement:"top-end"}},[e("div",{staticStyle:{width:"150px"},attrs:{slot:"content"},slot:"content"},[i.otherrequirements?e("div",[t._v("需求说明："+t._s(i.otherrequirements))]):t._e(),i.remarks?e("div",[t._v("报价备注："+t._s(i.remarks))]):t._e()]),e("el-button",{attrs:{type:"text"}},[t._v("备注")])],1):t._e()],2),e("td",{staticClass:"color_2"},[t._v(t._s(t.positiveFloat(i.unitprice)))]),e("td",{staticClass:"color_2"},["0"==t.info.is_Inside_outside?e("p",[t._v(t._s(i.provide_count))]):t._e(),"1"==t.info.is_Inside_outside?e("div",[e("p",[t._v("内部人员："+t._s(i.inside_roomcount))]),e("p",[t._v("外部人员："+t._s(i.outside_roomcount))])]):t._e()]),e("td",{staticClass:"color_2"},[t._v(t._s(t.positiveFloat(i.totalprice)))]),e("td",[e("el-input",{attrs:{type:"text",readonly:t.readonly},on:{input:function(e){i.settlement_unitprice=t.formatNum(i.settlement_unitprice,2)}},model:{value:i.settlement_unitprice,callback:function(e){t.$set(i,"settlement_unitprice",e)},expression:"room.settlement_unitprice"}})],1),e("td",["0"==t.info.is_Inside_outside?e("el-input",{class:{lineBack:!!i.lineoroffline},staticStyle:{width:"50%"},attrs:{placeholder:"请输入数量",readonly:t.readonly||!!i.lineoroffline},on:{input:function(e){i.settlement_count=t.formatNum(i.settlement_count,3)}},model:{value:i.settlement_count,callback:function(e){t.$set(i,"settlement_count",e)},expression:"room.settlement_count"}}):t._e(),"1"==t.info.is_Inside_outside?e("div",{staticStyle:{display:"flex"}},[e("el-input",{class:{lineBack:!!i.lineoroffline},staticStyle:{width:"55%"},attrs:{placeholder:"请输入数量",readonly:t.readonly||!!i.lineoroffline},on:{input:function(e){i.settlement_inside_roomcount=t.formatNum(i.settlement_inside_roomcount,3),i.settlement_count=t.positiveFloat(i.settlement_inside_roomcount)+t.positiveFloat(i.settlement_outside_roomcount)}},model:{value:i.settlement_inside_roomcount,callback:function(e){t.$set(i,"settlement_inside_roomcount",e)},expression:"room.settlement_inside_roomcount"}}),e("el-input",{class:{lineBack:!!i.lineoroffline},staticStyle:{width:"55%","margin-left":"10px"},attrs:{placeholder:"请输入数量",readonly:t.readonly||!!i.lineoroffline},on:{input:function(e){i.settlement_outside_roomcount=t.formatNum(i.settlement_outside_roomcount,3),i.settlement_count=t.positiveFloat(i.settlement_inside_roomcount)+t.positiveFloat(i.settlement_outside_roomcount)}},model:{value:i.settlement_outside_roomcount,callback:function(e){t.$set(i,"settlement_outside_roomcount",e)},expression:"room.settlement_outside_roomcount"}})],1):t._e()],1),e("td",[t._v(t._s(t.positiveFloat(t.positiveFloatSix(i.settlement_unitprice)*t.positiveFloat(i.settlement_count))))]),e("td",[t._v(t._s(i.settlement_customer_objection))]),e("td",[e("el-input",{class:{difference:t.roomDifference(i),line:!i.quoted_price_room_id},attrs:{readonly:t.readonly},model:{value:i.settlement_comments,callback:function(e){t.$set(i,"settlement_comments",e)},expression:"room.settlement_comments"}}),!i.quoted_price_room_id&&t.issubmit?e("el-button",{attrs:{icon:"el-icon-delete",type:"danger",circle:"",size:"mini"},on:{click:function(e){return t.delroom(s,o)}}}):t._e()],1)])}))],2)})),t.roomVisible?e("tbody",[e("tr",{staticClass:"color_2"},[e("th",{staticClass:"color_3"},[t._v("杂费小计")]),e("th",{staticClass:"color_3"}),e("th",{staticClass:"color_3"}),e("th",{staticClass:"color_3"}),e("th"),e("th"),e("th",{staticStyle:{"text-align":"right"}},[t._v("¥"+t._s(t.positiveFloat(t.roomPrice[2]*t.roomSettlementOut)))]),e("th"),e("th",[t.issubmit?e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addOther(1)}}},[t._v("添加杂费")]):t._e()],1)]),t._l(t.roomincidental,(function(s){return e("tr",{key:s.id},[e("td",{staticClass:"color_2"},[e("el-input",{attrs:{readonly:t.readonly,placeholder:"杂费项名称"},model:{value:s.content,callback:function(e){t.$set(s,"content",e)},expression:"roomzf.content"}})],1),e("td",{staticClass:"color_2"}),e("td",{staticClass:"color_2"}),e("td",{staticClass:"color_2"}),e("td",[e("el-input",{attrs:{readonly:t.readonly},on:{input:function(e){s.price=t.formatNum(s.price,2)}},model:{value:s.price,callback:function(e){t.$set(s,"price",e)},expression:"roomzf.price"}})],1),e("td",[e("el-input",{attrs:{readonly:t.readonly},on:{input:function(e){s.count=t.positiveFloatOne(s.count)}},model:{value:s.count,callback:function(e){t.$set(s,"count",e)},expression:"roomzf.count"}})],1),e("td",[t._v(t._s(t.positiveFloat(t.positiveFloatSix(s.price)*t.positiveFloat(s.count))))]),e("td",{staticClass:"color_2"}),e("td",[e("el-input",{staticClass:"line",attrs:{readonly:t.readonly},model:{value:s.comments,callback:function(e){t.$set(s,"comments",e)},expression:"roomzf.comments"}}),t.issubmit?e("el-button",{attrs:{icon:"el-icon-delete",type:"danger",circle:"",size:"mini"},on:{click:function(e){return t.delOther(s.id)}}}):t._e()],1)])}))],2):t._e(),t.conferenceVisible?e("tbody",[e("tr",{staticClass:"color_2"},[t._m(2),e("th",{staticClass:"color_3",staticStyle:{"text-align":"right"},attrs:{colspan:"3"}},[t._v(" 报价金额：¥"+t._s(t.positiveFloat(t.conferencePrice[0].all*t.conferenceOut))+" "),e("p",{staticStyle:{color:"#999"}},[t._v(t._s(t.conferenceOutMsg))])]),e("th",{staticStyle:{"text-align":"right"},attrs:{colspan:"4"}},[t._v(" 结算金额：¥"+t._s(t.positiveFloat(t.conferencePrice[1].all*t.conferenceSettlementOut))+" "),e("el-select",{attrs:{disabled:t.readonly,size:"mini",placeholder:"请选择"},on:{change:function(e){return t.conferenceVat(e)}},model:{value:t.info.settlement_conferencetaxid,callback:function(e){t.$set(t.info,"settlement_conferencetaxid",e)},expression:"info.settlement_conferencetaxid"}},t._l(t.info.taxlist,(function(t){return e("el-option",{key:t.id,attrs:{label:t.taxname,value:t.id}})})),1)],1),e("th")])]):t._e(),t._l(t.info.settlement_sheet_conference,(function(s,i){return e("tbody",{key:"huiyi"+i},[e("tr",{staticClass:"color_2"},[e("th",{staticClass:"color_3"},[e("i",[t._v(t._s(t._f("date_day_ex")(s.date)))])]),e("th",{staticClass:"color_3",staticStyle:{"text-align":"right"},attrs:{colspan:"3"}},[t._v("小计：¥"+t._s(t.positiveFloat(t.conferencePrice[0].subtotal["sub_"+i])))]),e("th",{staticStyle:{"text-align":"right"},attrs:{colspan:"4"}},[t._v("小计：¥"+t._s(t.positiveFloat(t.conferencePrice[1].subtotal["sub_"+i])))]),e("th",[t.issubmit?e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addconference(s)}}},[t._v("添加会场")]):t._e()],1)]),t._m(3,!0),t._l(s.conference_list,(function(i,o){return e("tr",{key:"conference"+o},[e("td",{staticClass:"color_2"},[i.quoted_price_conference_id?[1==i.type?[t._v(" "+t._s("场租-会场"+i.order_name+`(${i.roomsetuptypename};会议时间:${i.starttime}~${i.endtime};出席人数:${i.attendees}人)`)+" ")]:t._e(),2==i.type?[t._v(" "+t._s("会场搭建费-"+i.related_information+" ("+i.roomsetuptypename+")")+" ")]:t._e(),3==i.type?[t._v(" "+t._s("设备-会场"+i.order_name+`(${i.roomsetuptypename};${i.equipment})`)+" ")]:t._e(),4==i.type?[t._v(" "+t._s(i.settlement_itemname)+" ")]:t._e()]:[e("el-select",{attrs:{loading:t.cost_project_load,size:"small",filterable:""},on:{change:function(e){return t.changehuichang(e,i)}},model:{value:i.settlement_itemid,callback:function(e){t.$set(i,"settlement_itemid",e)},expression:"conference.settlement_itemid"}},t._l(t.meetingcostProjects,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],i.quoted_price_conference_id&&(i.describe||i.comments)?e("el-tooltip",{staticClass:"describe-tooltip",attrs:{effect:"dark",placement:"top-end"}},[e("div",{staticStyle:{width:"150px"},attrs:{slot:"content"},slot:"content"},[i.describe?e("div",[t._v("需求说明："+t._s(i.describe))]):t._e(),i.comments?e("div",[t._v("报价备注："+t._s(i.comments))]):t._e()]),e("el-button",{attrs:{type:"text"}},[t._v("备注")])],1):t._e()],2),e("td",{staticClass:"color_2"},[t._v(t._s(t.positiveFloat(i.price)))]),e("td",{staticClass:"color_2"},[t._v(t._s(i.count))]),e("td",{staticClass:"color_2"},[t._v(t._s(t.positiveFloat(t.positiveFloat(i.count)*t.positiveFloatSix(i.price))))]),e("td",[e("el-input",{attrs:{type:"text",readonly:t.readonly},on:{input:function(e){i.settlement_price=t.formatNum(i.settlement_price,2)}},model:{value:i.settlement_price,callback:function(e){t.$set(i,"settlement_price",e)},expression:"conference.settlement_price"}})],1),e("td",[e("el-input",{class:{lineBack:!!i.lineoroffline},staticStyle:{width:"50%"},attrs:{placeholder:"请输入数量",readonly:t.readonly||!!i.lineoroffline},on:{input:function(e){i.settlement_count=t.formatNum(i.settlement_count,2)}},model:{value:i.settlement_count,callback:function(e){t.$set(i,"settlement_count",e)},expression:"conference.settlement_count"}})],1),e("td",[t._v(t._s(t.positiveFloat(t.positiveFloatSix(i.settlement_price)*t.positiveFloat(i.settlement_count))))]),e("td",[t._v(t._s(i.settlement_customer_objection))]),e("td",[e("el-input",{class:{difference:t.conferenceDifference(i),line:!i.quoted_price_conference_id},attrs:{readonly:t.readonly},model:{value:i.settlement_comments,callback:function(e){t.$set(i,"settlement_comments",e)},expression:"conference.settlement_comments"}}),!i.quoted_price_conference_id&&t.issubmit?e("el-button",{attrs:{icon:"el-icon-delete",type:"danger",circle:"",size:"mini"},on:{click:function(e){return t.delconference(s,o)}}}):t._e()],1)])}))],2)})),t.conferenceVisible?e("tbody",[e("tr",{staticClass:"color_2"},[e("th",{staticClass:"color_3"},[t._v("杂费小计")]),e("th",{staticClass:"color_3"}),e("th",{staticClass:"color_3"}),e("th",{staticClass:"color_3"}),e("th",[t._v("单价（元）")]),e("th",[t._v("数量")]),e("th",{staticStyle:{"text-align":"right"}},[t._v("¥"+t._s(t.positiveFloat(t.conferencePrice[2]*t.conferenceSettlementOut)))]),e("th"),e("th",[t.issubmit?e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addOther(2)}}},[t._v("添加杂费")]):t._e()],1)]),t._l(t.meetingcidental,(function(s){return e("tr",{key:s.id},[e("td",{staticClass:"color_2"},[e("el-input",{attrs:{readonly:t.readonly,placeholder:"杂费项名称"},model:{value:s.content,callback:function(e){t.$set(s,"content",e)},expression:"conferencezf.content"}})],1),e("td",{staticClass:"color_2"}),e("td",{staticClass:"color_2"}),e("td",{staticClass:"color_2"}),e("td",[e("el-input",{attrs:{type:"text",readonly:t.readonly},on:{input:function(e){s.price=t.formatNum(s.price,2)}},model:{value:s.price,callback:function(e){t.$set(s,"price",e)},expression:"conferencezf.price"}})],1),e("td",[e("el-input",{attrs:{readonly:t.readonly},on:{input:function(e){s.count=t.positiveFloatOne(s.count)}},model:{value:s.count,callback:function(e){t.$set(s,"count",e)},expression:"conferencezf.count"}})],1),e("td",[t._v(t._s(t.positiveFloat(t.positiveFloatSix(s.price)*t.positiveFloat(s.count))))]),e("td",{staticClass:"color_2"}),e("td",[e("el-input",{staticClass:"line",attrs:{readonly:t.readonly},model:{value:s.comments,callback:function(e){t.$set(s,"comments",e)},expression:"conferencezf.comments"}}),t.issubmit?e("el-button",{attrs:{icon:"el-icon-delete",type:"danger",circle:"",size:"mini"},on:{click:function(e){return t.delOther(s.id)}}}):t._e()],1)])}))],2):t._e(),t.foodVisible?e("tbody",[e("tr",{staticClass:"color_2"},[t._m(4),e("th",{staticClass:"color_3",staticStyle:{"text-align":"right"},attrs:{colspan:"3"}},[t._v(" 报价金额：¥"+t._s(t.positiveFloat(t.foodPrice[0].all*t.foodOut))+" "),e("p",{staticStyle:{color:"#999"}},[t._v(t._s(t.foodOutMsg))])]),e("th",{staticStyle:{"text-align":"right"},attrs:{colspan:"4"}},[t._v(" 结算金额：¥"+t._s(t.positiveFloat(t.foodPrice[1].all*t.foodSettlementOut))+" "),e("el-select",{attrs:{disabled:t.readonly,size:"mini",placeholder:"请选择"},on:{change:function(e){return t.foodVat(e)}},model:{value:t.info.settlement_foodtaxid,callback:function(e){t.$set(t.info,"settlement_foodtaxid",e)},expression:"info.settlement_foodtaxid"}},t._l(t.info.taxlist,(function(t){return e("el-option",{key:t.id,attrs:{label:t.taxname,value:t.id}})})),1)],1),e("th")])]):t._e(),t._l(t.info.settlement_sheet_food,(function(s,i){return e("tbody",{key:"canyin"+i},[e("tr",{staticClass:"color_2"},[e("th",{staticClass:"color_3"},[e("i",[t._v(t._s(t._f("date_day_ex")(s.date)))])]),e("th",{staticClass:"color_3",staticStyle:{"text-align":"right"},attrs:{colspan:"3"}},[t._v("小计：¥"+t._s(t.positiveFloat(t.foodPrice[0].subtotal["sub_"+i]*t.foodOut)))]),e("th",{staticStyle:{"text-align":"right"},attrs:{colspan:"4"}},[t._v("小计：¥"+t._s(t.positiveFloat(t.foodPrice[1].subtotal["sub_"+i]*t.foodSettlementOut)))]),e("th",[t.issubmit?e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addfood(s)}}},[t._v("添加餐饮")]):t._e()],1)]),t._m(5,!0),t._l(s.food_list,(function(i,o){return e("tr",{key:"food"+o},[e("td",{staticClass:"color_2"},[i.quoted_price_food_id?[t._v(" "+t._s(i.foodtypename)+" "),i.usetypename?e("span",[t._v("["+t._s(i.usetypename)+"]")]):t._e()]:[e("el-select",{attrs:{loading:t.cost_project_load,size:"small",filterable:""},on:{change:function(e){return t.changehotelnei(e,i)}},model:{value:i.settlement_itemid,callback:function(e){t.$set(i,"settlement_itemid",e)},expression:"food.settlement_itemid"}},t._l(t.foodcostProjects,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],i.quoted_price_food_id&&(i.comments||i.offer_remarks)?e("el-tooltip",{staticClass:"describe-tooltip",attrs:{effect:"dark",placement:"top-end"}},[e("div",{staticStyle:{width:"150px"},attrs:{slot:"content"},slot:"content"},[i.comments?e("div",[t._v("需求说明："+t._s(i.comments))]):t._e(),i.offer_remarks?e("div",[t._v("报价备注："+t._s(i.offer_remarks))]):t._e()]),e("el-button",{attrs:{type:"text"}},[t._v("备注")])],1):t._e()],2),e("td",{staticClass:"color_2"},[i.quoted_price_food_id||!i.quoted_price_food_id&&i.settlement_itemid?[t._v(" "+t._s(t.positiveFloat(i.price))+" ")]:t._e()],2),e("td",{staticClass:"color_2"},[t._v(t._s(i.personcount))]),e("td",{staticClass:"color_2"},[t._v(t._s(t.positiveFloat(t.positiveFloat(i.personcount)*t.positiveFloatSix(i.price))))]),e("td",[e("el-input",{attrs:{readonly:t.readonly},on:{input:function(e){i.settlement_unitprice=t.formatNum(i.settlement_unitprice)}},model:{value:i.settlement_unitprice,callback:function(e){t.$set(i,"settlement_unitprice",e)},expression:"food.settlement_unitprice"}})],1),e("td",[e("el-input",{staticStyle:{width:"50%"},attrs:{placeholder:"请输入数量",readonly:t.readonly},on:{input:function(e){i.settlement_count=t.formatNum(i.settlement_count,2)}},model:{value:i.settlement_count,callback:function(e){t.$set(i,"settlement_count",e)},expression:"food.settlement_count"}})],1),e("td",[t._v(t._s(t.positiveFloat(t.positiveFloatSix(i.settlement_unitprice)*t.positiveFloat(i.settlement_count))))]),e("td",[t._v(t._s(i.settlement_customer_objection))]),e("td",[e("el-input",{class:{difference:t.foodDifference(i),line:!i.quoted_price_food_id},attrs:{readonly:t.readonly},model:{value:i.settlement_comments,callback:function(e){t.$set(i,"settlement_comments",e)},expression:"food.settlement_comments"}}),!i.quoted_price_food_id&&t.issubmit?e("el-button",{attrs:{icon:"el-icon-delete",type:"danger",circle:"",size:"mini"},on:{click:function(e){return t.delfood(s,o)}}}):t._e()],1)])}))],2)})),t.foodVisible?e("tbody",[e("tr",{staticClass:"color_2"},[e("th",{staticClass:"color_3"},[t._v("杂费小计")]),e("th",{staticClass:"color_3"}),e("th",{staticClass:"color_3"}),e("th",{staticClass:"color_3"}),e("th"),e("th"),e("th",{staticStyle:{"text-align":"right"}},[t._v("¥"+t._s(t.positiveFloat(t.foodPrice[2]*t.foodSettlementOut)))]),e("th"),e("th",[t.issubmit?e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addOther(3)}}},[t._v("添加杂费")]):t._e()],1)]),t._l(t.foodincidental,(function(s){return e("tr",{key:s.id},[e("td",{staticClass:"color_2"},[e("el-input",{attrs:{readonly:t.readonly,placeholder:"杂费项名称"},model:{value:s.content,callback:function(e){t.$set(s,"content",e)},expression:"foodzf.content"}})],1),e("td",{staticClass:"color_2"}),e("td",{staticClass:"color_2"}),e("td",{staticClass:"color_2"}),e("td",[e("el-input",{attrs:{type:"text",readonly:t.readonly},on:{input:function(e){s.price=t.formatNum(s.price,2)}},model:{value:s.price,callback:function(e){t.$set(s,"price",e)},expression:"foodzf.price"}})],1),e("td",[e("el-input",{attrs:{readonly:t.readonly},on:{input:function(e){s.count=t.positiveFloatOne(s.count)}},model:{value:s.count,callback:function(e){t.$set(s,"count",e)},expression:"foodzf.count"}})],1),e("td",[t._v(t._s(t.positiveFloat(t.positiveFloatSix(s.price)*t.positiveFloat(s.count))))]),e("td",{staticClass:"color_2"}),e("td",[e("el-input",{staticClass:"line",attrs:{readonly:t.readonly},model:{value:s.comments,callback:function(e){t.$set(s,"comments",e)},expression:"foodzf.comments"}}),t.issubmit?e("el-button",{attrs:{icon:"el-icon-delete",type:"danger",circle:"",size:"mini"},on:{click:function(e){return t.delOther(s.id)}}}):t._e()],1)])}))],2):t._e()],2),e("div",{staticClass:"qita"},[e("div",{staticClass:"left"},[e("div",{staticClass:"stitle"},[t._v("客户异议")]),e("div",{staticClass:"context"},[t._v(t._s(t.info.settlement_customer_objection))])]),e("div",{staticClass:"right"},[e("div",{staticClass:"stitle"},[t._v("其他说明")]),e("div",{staticClass:"context"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.info.settlement_offer_remarks,expression:"info.settlement_offer_remarks"}],domProps:{value:t.info.settlement_offer_remarks},on:{input:function(e){e.target.composing||t.$set(t.info,"settlement_offer_remarks",e.target.value)}}})])])])]):t._e(),e("div",{staticClass:"excel"},[e("a",{attrs:{download:""},on:{click:t.excelDownload}},[t._v("导出结算单")])]),e("div",{staticClass:"submit"},[["0020-1","0020-4","0020-7","0020-8"].includes(this.info.orderstatus)?e("el-button",{on:{click:t.draft}},[t._v("保存到草稿箱")]):t._e(),["0020-4","0020-7","0020-8"].includes(this.info.orderstatus)?e("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("提交结算单")]):t._e()],1),t.info.historylist&&t.info.historylist.length>0?e("div",{staticClass:"info"},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"header clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("历史结算单：")])]),t._l(t.info.historylist,(function(s,i){return e("div",{key:s.id,staticClass:"text item"},[t._v(" 第"+t._s(i+1)+"次结算, 总价￥"+t._s(t.positiveFloat(s.settlement_total_price))+"元，[ "+t._s(t._f("date_ex")(s.submit_time))+" ] ")])}))],2)],1):t._e(),e("el-dialog",{attrs:{visible:t.addSettleShow,title:"添加结算项目",center:"",width:"600px"},on:{"update:visible":function(e){t.addSettleShow=e},close:function(e){t.addSettleShow=!1}}},[e("el-form",{ref:"addSettleInfo",attrs:{model:t.addSettleInfo,rules:t.addSettleRules,"label-width":"200px"}},[e("el-form-item",{attrs:{label:"选择项目分类",prop:"projectClass"}},[e("el-select",{staticClass:"demand_300",attrs:{size:"small",clearable:"",filterable:""},on:{change:t.changeProjectClass},model:{value:t.addSettleInfo.projectClass,callback:function(e){t.$set(t.addSettleInfo,"projectClass",e)},expression:"addSettleInfo.projectClass"}},t._l(t.projectClass,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.needCostDate,expression:"needCostDate"}],attrs:{label:"选择费用发生日期",prop:"costDate"}},[e("el-select",{staticClass:"demand_300",attrs:{size:"small",clearable:"",filterable:""},model:{value:t.addSettleInfo.costDate,callback:function(e){t.$set(t.addSettleInfo,"costDate",e)},expression:"addSettleInfo.costDate"}},t._l(t.costDates,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:"选择费用项目",prop:"costProject"}},[e("el-select",{staticClass:"demand_300",attrs:{loading:t.cost_project_load,size:"small",clearable:"",filterable:""},on:{change:t.changecostProject},model:{value:t.addSettleInfo.costProject,callback:function(e){t.$set(t.addSettleInfo,"costProject",e)},expression:"addSettleInfo.costProject"}},t._l(t.costProjects,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),e("span",{staticClass:"dialog-footer flex_row justify_center",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:function(e){t.addSettleShow=!1}}},[t._v("取 消")]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.addSettle}},[t._v("添 加")])],1)],1)],1):t._e()},o=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"color_2"},[e("th",[t._v("凭证名称")]),e("th",[t._v("文件")]),e("th",[t._v("客户异议")]),e("th",[t._v("说明")])])])},function(){var t=this,e=t._self._c;return e("th",{staticClass:"color_3"},[e("i",{staticStyle:{color:"#428bca"}},[t._v("客房")])])},function(){var t=this,e=t._self._c;return e("th",{staticClass:"color_3"},[e("i",{staticStyle:{color:"#428bca"}},[t._v("会场")])])},function(){var t=this,e=t._self._c;return e("tr",{staticClass:"color_2"},[e("th",{staticClass:"color_3"},[t._v("消费项目")]),e("th",{staticClass:"color_3"},[t._v("单价(元)")]),e("th",{staticClass:"color_3"},[t._v("数量")]),e("th",{staticClass:"color_3"},[t._v("金额(元)")]),e("th",[t._v("单价(元)")]),e("th",[t._v("数量")]),e("th",[t._v("金额(元)")]),e("th",[t._v("客户异议")]),e("th",[t._v("结算说明")])])},function(){var t=this,e=t._self._c;return e("th",{staticClass:"color_3"},[e("i",{staticStyle:{color:"#428bca"}},[t._v("餐饮")])])},function(){var t=this,e=t._self._c;return e("tr",{staticClass:"color_2"},[e("th",{staticClass:"color_3"},[t._v("消费项目")]),e("th",{staticClass:"color_3"},[t._v("单价(元)")]),e("th",{staticClass:"color_3"},[t._v("数量")]),e("th",{staticClass:"color_3"},[t._v("金额(元)")]),e("th",[t._v("单价(元)")]),e("th",[t._v("数量")]),e("th",[t._v("金额(元)")]),e("th",[t._v("客户异议")]),e("th",[t._v("结算说明")])])}],n=s("cf45"),l=s("0e5c"),a=s("2f42"),r=s.n(a),c=s("df68"),_=s("acd6"),d=(s("b587"),{data(){return{info:null,fileList:[],fileList2:[],fileList3:[],fileList4:[],fileList5:[],status_draft:"0029-1",status_tobeconfirmed:"0029-2",status_confirm:"0029-3",status_supplement:"0029-5",status_reject:"0029-4",settlement_status:"0029-3",errormsg:[],quoted_price_food_option:[{value:0,label:"酒店内用餐"},{value:1,label:"酒店外用餐"}],orderIDList:[],roomOut:1,roomSettlementOut:1,roomOutMsg:"",conferenceOut:1,conferenceSettlementOut:1,conferenceOutMsg:"",foodOut:1,foodSettlementOut:1,foodOutMsg:"",transportationOut:1,transportationOutMsg:"",carOut:1,carOutMsg:"",otherOut:1,otherOutMsg:"",arrayList:[{type:1,fileList:[],name:"酒店住宿发票+小联",remark:"",dissent:""},{type:2,fileList:[],name:"酒店餐饮发票+小联",remark:"",dissent:""},{type:3,fileList:[],name:"酒店会场发票+小联",remark:"",dissent:""},{type:4,fileList:[],name:"其他",remark:"",dissent:""},{type:5,fileList:[],name:"供应商发票及账单",remark:"",dissent:""}],updateIndex:0,updateFileIndex:0,rename:!1,fileName:"",suffix:"",downloadUrl:"",addSettleShow:!1,projectClass:[{value:"0034",label:"客房"},{value:"0049",label:"会场"},{value:"0050",label:"酒店内餐饮"}],costDates:[],roomcostProjects:[],meetingcostProjects:[],costProjefoodcostProjectscts:[],cost_project_load:!1,costProjects:[],addSettleRules:{projectClass:[{required:!0,message:"请选择项目分类",trigger:"change"}],costDate:[{required:!0,message:"请选择费用发生日期",trigger:"change"}],costProject:[{required:!0,message:"请选择费用项目",trigger:"change"}]},addSettleInfo:{projectClass:"0034",costDate:"",costProject:""},needCostDate:!0}},computed:{issubmit(){return 1==this.$route.params.issubmit},readonly(){return 0==this.$route.params.issubmit},isconfirm(){return this.info.settlement_status==this.status_confirm},issupplement(){return this.info.settlement_status==this.status_supplement},formateDate:()=>function(t){return Object(n["d"])("YYYY年mm月dd日",new Date(t))},roomVisible:function(){return this.info.settlement_sheet_room&&this.info.settlement_sheet_room.length>0},conferenceVisible:function(){return this.info.settlement_sheet_conference&&this.info.settlement_sheet_conference.length>0},foodVisible:function(){return this.info.settlement_sheet_food&&this.info.settlement_sheet_food.length>0},transportationVisible:function(){return this.info.settlement_sheet_transportation&&this.info.settlement_sheet_transportation.length>0},carVisible:function(){return this.info.settlement_sheet_car&&this.info.settlement_sheet_car.length>0},roomincidental(){return this.info.settlement_sheet_sundries.filter(t=>1==t.type)},meetingcidental(){return this.info.settlement_sheet_sundries.filter(t=>2==t.type)},foodincidental(){return this.info.settlement_sheet_sundries.filter(t=>3==t.type)},intercitytrafficincidental(){return this.info.settlement_sheet_sundries.filter(t=>4==t.type)},carincidental(){return this.info.settlement_sheet_sundries.filter(t=>5==t.type)},otherincidental(){return this.info.settlement_sheet_sundries.filter(t=>6==t.type)},roomPrice(){let t=[{all:0,subtotal:{}},{all:0,subtotal:{}},0],e=t[0].subtotal,s=t[1].subtotal;return this.info.settlement_sheet_room.forEach((i,o)=>{e["sub_"+o]||(e["sub_"+o]=0),s["sub_"+o]||(s["sub_"+o]=0),i.room_list.forEach(i=>{e["sub_"+o]+=Object(n["o"])(i.totalprice),t[0].all+=Object(n["o"])(i.totalprice);let l=0;l=0==this.info.is_Inside_outside?i.settlement_count:Object(n["m"])(i.settlement_inside_roomcount)+Object(n["m"])(i.settlement_outside_roomcount),s["sub_"+o]+=Object(n["o"])(i.settlement_unitprice)*Object(n["m"])(l),t[1].all+=Object(n["o"])(i.settlement_unitprice)*Object(n["m"])(l)})}),this.roomincidental.forEach(e=>{t[1].all+=+Object(n["o"])(e.price)*Object(n["m"])(e.count),t[2]+=Object(n["o"])(e.price)*Object(n["m"])(e.count)}),t},adddifferenceerrormsg:()=>function(t,e,s){let i="";1==t?i=this.formateDate(e)+"客房,第"+s+"行,单价(元)或数量存在差异,请填写结算说明":2==t?i=this.formateDate(e)+"会场,第"+s+"行,单价(元)或数量存在差异,请填写结算说明":3==t?i=this.formateDate(e)+"餐饮,第"+s+"行,单价(元)或数量存在差异,请填写结算说明":4==t?i=this.formateDate(e)+"大交通,第"+s+"行,单价(元)或数量存在差异,请填写结算说明":5==t?i=this.formateDate(e)+"地面交通,第"+s+"行,单价(元)或数量存在差异,请填写结算说明":6==t&&(i="其他服务,第"+s+"行,单价(元)或数量存在差异,请填写结算说明"),this.errormsg.push(i)},addnewitemerrormsg:()=>function(t,e,s){let i="";1==t?i=this.formateDate(e)+"新增客房,第"+s+"行,消费项目名称为必填项,请填写消费项目名称":2==t?i=this.formateDate(e)+"新增会场,第"+s+"行,消费项目名称为必填项,请填写消费项目名称":3==t?i=this.formateDate(e)+"新增餐饮,第"+s+"行,消费项目名称为必填项,请填写消费项目名称":4==t?i=this.formateDate(e)+"新增大交通,第"+s+"行,消费项目名称为必填项,请填写消费项目名称":5==t&&(i=this.formateDate(e)+"新增地面交通,第"+s+"行,消费项目名称为必填项,请填写消费项目名称"),this.errormsg.push(i)},addnewitemhasnocommments:()=>function(t,e,s){let i="";1==t?i=this.formateDate(e)+"新增客房,第"+s+"行,结算说明为必填项,请填写结算说明":2==t?i=this.formateDate(e)+"新增会场,第"+s+"行,结算说明为必填项,请填写结算说明":3==t?i=this.formateDate(e)+"新增餐饮,第"+s+"行,结算说明为必填项,请填写结算说明":4==t?i=this.formateDate(e)+"新增大交通,第"+s+"行,结算说明为必填项,请填写结算说明":5==t&&(i=this.formateDate(e)+"新增地面交通,第"+s+"行,结算说明为必填项,请填写结算说明"),this.errormsg.push(i)},roomDifference:()=>function(t){return Object(n["o"])(t.unitprice)!==Object(n["o"])(t.settlement_unitprice)||Object(n["m"])(t.provide_count)!==Object(n["m"])(t.settlement_count)||!t.quoted_price_room_id&&""==t.settlement_comments},checkRoomDifference:function(){let t=!1;this.info.settlement_sheet_room&&this.info.settlement_sheet_room.length>0&&this.info.settlement_sheet_room.forEach(e=>{if(e.room_list&&e.room_list.length>0){e.room_list.forEach((s,i)=>{t=this.roomDifference(s),!t||null==s.quoted_price_room_id||null!=s.settlement_comments&&""!=s.settlement_comments||this.adddifferenceerrormsg(1,e.date,i+1),!t||null!=s.quoted_price_room_id||null!=s.settlement_comments&&""!=s.settlement_comments||this.addnewitemhasnocommments(1,e.date,i+1)});let s=e.room_list.filter(t=>null==t.quoted_price_room_id&&""==t.settlement_itemname);s.length>0&&s.forEach((t,s)=>{this.addnewitemerrormsg(1,e.date,s+1)})}})},conferencePrice(){let t=[{all:0,subtotal:{}},{all:0,subtotal:{}},0],e=t[0].subtotal,s=t[1].subtotal;return this.info.settlement_sheet_conference.forEach((i,o)=>{e["sub_"+o]||(e["sub_"+o]=0),s["sub_"+o]||(s["sub_"+o]=0),i.conference_list.forEach(i=>{let l=Object(n["o"])(i.price)*Object(n["m"])(i.count),a=Object(n["o"])(i.settlement_price)*Object(n["m"])(i.settlement_count);e["sub_"+o]+=l,t[0].all+=l,s["sub_"+o]+=a,t[1].all+=a})}),this.meetingcidental.forEach(e=>{let s=Object(n["o"])(e.price)*Object(n["m"])(e.count);t[1].all+=s,t[2]+=s}),t},conferenceDifference:()=>function(t){return Object(n["o"])(t.price)!==Object(n["o"])(t.settlement_price)||Object(n["m"])(t.count)!==Object(n["m"])(t.settlement_count)||!t.quoted_price_conference_id&&""==t.settlement_comments},checkConferenceDifference:function(){let t=!1;this.info.settlement_sheet_conference&&this.info.settlement_sheet_conference.length>0&&this.info.settlement_sheet_conference.forEach(e=>{if(e.conference_list&&e.conference_list.length>0){e.conference_list.forEach((s,i)=>{t=this.conferenceDifference(s),!t||null==s.quoted_price_conference_id||null!=s.settlement_comments&&""!=s.settlement_comments||this.adddifferenceerrormsg(2,e.date,i+1),!t||null!=s.quoted_price_conference_id||null!=s.settlement_comments&&""!=s.settlement_comments||this.addnewitemhasnocommments(2,e.date,i+1)});let s=e.conference_list.filter(t=>null==t.quoted_price_conference_id&&""==t.settlement_itemname);s.length>0&&s.forEach((t,s)=>{this.addnewitemerrormsg(2,e.date,s+1)})}})},foodPrice(){let t=[{all:0,subtotal:{}},{all:0,subtotal:{}},0],e=t[0].subtotal,s=t[1].subtotal;return this.info.settlement_sheet_food.forEach((i,o)=>{e["sub_"+o]||(e["sub_"+o]=0),s["sub_"+o]||(s["sub_"+o]=0),i.food_list.forEach(i=>{let l=Object(n["o"])(i.price)*Object(n["m"])(i.personcount),a=Object(n["o"])(i.settlement_unitprice)*Object(n["m"])(i.settlement_count);e["sub_"+o]+=l,t[0].all+=l,s["sub_"+o]+=a,t[1].all+=a})}),this.foodincidental.forEach(e=>{let s=Object(n["o"])(e.price)*Object(n["m"])(e.count);t[1].all+=s,t[2]+=s}),t},foodDifference(){return function(t){return Object(n["o"])(t.price)!==Object(n["o"])(t.settlement_unitprice)||Object(n["m"])(t.personcount)!==Object(n["m"])(t.settlement_count)||!t.quoted_price_food_id&&""==t.settlement_comments}},checkFoodDifference:function(){let t=!1;this.info.settlement_sheet_food&&this.info.settlement_sheet_food.length>0&&this.info.settlement_sheet_food.forEach(e=>{if(e.food_list&&e.food_list.length>0){e.food_list.forEach((s,i)=>{t=this.foodDifference(s),!t||null==s.quoted_price_food_id||null!=s.settlement_comments&&""!=s.settlement_comments||this.adddifferenceerrormsg(3,e.date,i+1),!t||null!=s.quoted_price_food_id||null!=s.settlement_comments&&""!=s.settlement_comments||this.addnewitemhasnocommments(3,e.date,i+1)});let s=e.food_list.filter(t=>null==t.quoted_price_food_id&&""==t.settlement_itemname);s.length>0&&s.forEach((t,s)=>{this.addnewitemerrormsg(3,e.date,s+1)})}})},intercitytrafficPrice(){let t=[{all:0,subtotal:{}},{all:0,subtotal:{}},0],e=t[0].subtotal,s=t[1].subtotal;return this.info.settlement_sheet_transportation.forEach((i,o)=>{e["sub_"+o]||(e["sub_"+o]=0),s["sub_"+o]||(s["sub_"+o]=0),i.transportation_list.forEach(i=>{let l=Object(n["o"])(i.unitprice)*Object(n["m"])(i.passengercount),a=Object(n["o"])(i.settlement_unitprice)*Object(n["m"])(i.settlement_count);e["sub_"+o]+=l,t[0].all+=l,s["sub_"+o]+=a,t[1].all+=a})}),this.intercitytrafficincidental.forEach(e=>{let s=Object(n["o"])(e.price)*Object(n["m"])(e.count);t[1].all+=s,t[2]+=s}),t},transportationDifference(){return function(t){return Object(n["o"])(t.unitprice)!==Object(n["o"])(t.settlement_unitprice)||Object(n["m"])(t.passengercount)!==Object(n["m"])(t.settlement_count)||!t.quoted_price_transportation_id&&""==t.settlement_comments}},checkTransportationDifference:function(){let t=!1;this.info.settlement_sheet_transportation&&this.info.settlement_sheet_transportation.length>0&&this.info.settlement_sheet_transportation.forEach(e=>{if(e.transportation_list&&e.transportation_list.length>0){e.transportation_list.forEach((s,i)=>{t=this.transportationDifference(s),!t||null==s.quoted_price_transportation_id||null!=s.settlement_comments&&""!=s.settlement_comments||this.adddifferenceerrormsg(4,e.date,i+1),!t||null!=s.quoted_price_transportation_id||null!=s.settlement_comments&&""!=s.settlement_comments||this.addnewitemhasnocommments(4,e.date,i+1)});let s=e.transportation_list.filter(t=>null==t.quoted_price_transportation_id&&""==t.settlement_itemname);s.length>0&&s.forEach((t,s)=>{this.addnewitemerrormsg(5,e.date,s+1)})}})},carPrice(){let t=[{all:0,subtotal:{}},{all:0,subtotal:{}},0],e=t[0].subtotal,s=t[1].subtotal;return this.info.settlement_sheet_car.forEach((i,o)=>{e["sub_"+o]||(e["sub_"+o]=0),s["sub_"+o]||(s["sub_"+o]=0),i.car_list.forEach(i=>{let l=Object(n["o"])(i.price)*Object(n["m"])(i.carcount),a=Object(n["o"])(i.settlement_unitprice)*Object(n["m"])(i.settlement_count);e["sub_"+o]+=l,t[0].all+=l,s["sub_"+o]+=a,t[1].all+=a})}),this.carincidental.forEach(e=>{let s=Object(n["o"])(e.price)*Object(n["m"])(e.count);t[1].all+=s,t[2]+=s}),t},carDifference(){return function(t){return Object(n["o"])(t.price)!==Object(n["o"])(t.settlement_unitprice)||Object(n["m"])(t.carcount)!==Object(n["m"])(t.settlement_count)||!t.quoted_price_car_id&&""==t.settlement_comments}},checkCarDifference:function(){let t=!1;this.info.settlement_sheet_car&&this.info.settlement_sheet_car.length>0&&this.info.settlement_sheet_car.forEach(e=>{if(e.car_list&&e.car_list.length>0){e.car_list.forEach((s,i)=>{t=this.carDifference(s),!t||null==s.quoted_price_car_id||null!=s.settlement_comments&&""!=s.settlement_comments||this.adddifferenceerrormsg(5,e.date,i+1),!t||null!=s.quoted_price_car_id||null!=s.settlement_comments&&""!=s.settlement_comments||this.addnewitemhasnocommments(5,e.date,i+1)});let s=e.car_list.filter(t=>null==t.quoted_price_car_id&&""==t.settlement_itemname);s.length>0&&s.forEach((t,s)=>{this.addnewitemerrormsg(4,e.date,s+1)})}})},otherPrice(){let t=[0,0,0];return this.info.settlement_sheet_other.forEach((e,s)=>{let i=Object(n["o"])(e.price)*Object(n["m"])(e.offerservicedaycount)*Object(n["m"])(e.offerparticipatecount),o=Object(n["o"])(e.settlement_unitprice)*Object(n["m"])(e.settlement_count);t[0]=t[0]+i,t[1]=t[1]+o}),this.otherincidental.forEach(e=>{let s=Object(n["o"])(e.price)*Object(n["m"])(e.count);t[1]=t[1]+s,t[2]=t[2]+s}),t},otherDifference(){return function(t){return Object(n["o"])(t.price)!==Object(n["o"])(t.settlement_unitprice)||Object(n["m"])(t.offerservicedaycount)*Object(n["m"])(t.offerparticipatecount)!==Object(n["m"])(t.settlement_count)||!t.quoted_price_other_id&&""==t.settlement_comments}},checkOtherDifference:function(){let t=!1;this.info.settlement_sheet_other&&this.info.settlement_sheet_other.length>0&&this.info.settlement_sheet_other.forEach((e,s)=>{t=this.otherDifference(e),!t||null!=e.settlement_comments&&""!=e.settlement_comments||this.adddifferenceerrormsg(6,null,s+1)})},servicePrice(){let t=[0,0];return t[0]=Object(n["o"])(this.info.advance_amount)*Object(n["o"])(this.info.advance_proportion/100)+Object(n["o"])(this.info.travelagency_payment_money)*Object(n["o"])(this.info.travelagency_payment_proportion/100)+Object(n["o"])(this.info.off_hotel_expenses)*Object(n["o"])(this.info.off_hotel_proportion/100),t[1]=Object(n["o"])(Object(n["o"])(this.info.settlement_advance_amount)*this.info.settlement_advance_proportion/100)+this.InTheHotelMoney*Object(n["o"])(this.info.settlement_travelagency_payment_proportion/100)+this.OutsideTheHotelMoney*Object(n["o"])(this.info.settlement_off_hotel_proportion/100),this.info.feizhicai_service=t[1],this.info.taxation=0,t},price_no(){let t=[0,0];return t[0]=this.roomPrice[0].all*this.roomOut+this.conferencePrice[0].all*this.conferenceOut+this.foodPrice[0].all*this.foodOut,t[1]=this.roomPrice[1].all*this.roomSettlementOut+this.conferencePrice[1].all*this.conferenceSettlementOut+this.foodPrice[1].all*this.foodSettlementOut,this.info.settlement_total_amount=t[1]||0,t},price(){let t=[0,0];return t[0]=this.price_no[0]+this.servicePrice[0]+Object(n["o"])((this.price_no[0]+this.servicePrice[0])*Object(n["m"])(this.info.taxrate)/100),this.info.settlement_total_amount=this.price_no[1]+this.servicePrice[1]+Object(n["o"])((this.price_no[1]+this.servicePrice[1])*Object(n["m"])(this.info.settlement_taxrate)/100),t[1]=this.info.settlement_total_amount,t},InTheHotelMoney(){let t=0;this.info.settlement_sheet_food.forEach(e=>{e.food_list.forEach(e=>{0==e.addresstype&&(t+=Object(n["o"])(e.settlement_unitprice)*Object(n["m"])(e.settlement_count))})});let e=0;return this.foodincidental.forEach(t=>{let s=Object(n["o"])(t.price)*Object(n["m"])(t.count);t.isnotservice||(e+=s)}),this.roomPrice[1].all+this.conferencePrice[1].all+t+e},OutsideTheHotelMoney(){let t=0;this.info.settlement_sheet_food.forEach(e=>{e.food_list.forEach(e=>{1==e.addresstype&&(t+=Object(n["o"])(e.settlement_unitprice)*Object(n["m"])(e.settlement_count))})});let e=0;this.info.settlement_sheet_other.forEach(t=>{1!=t.islocalguide&&(e+=Object(n["o"])(t.settlement_unitprice)*Object(n["m"])(t.settlement_count))});let s=0;return this.otherincidental.forEach(t=>{let e=Object(n["o"])(t.price)*Object(n["m"])(t.count);t.isnotservice||(s+=e)}),this.intercitytrafficincidental.forEach(t=>{let e=Object(n["o"])(t.price)*Object(n["m"])(t.count);t.isnotservice||(s+=e)}),this.foodincidental.forEach(t=>{let e=Object(n["o"])(t.price)*Object(n["m"])(t.count);t.isnotservice&&(s+=e)}),this.intercitytrafficPrice[1].all-this.intercitytrafficPrice[2]+this.carPrice[1].all+t+e+s}},methods:{guid:n["k"],positiveInteger:n["q"],positiveFloat:n["m"],positiveFloatOne:n["n"],positiveFloatSix:n["o"],formatNum:n["e"],excelExport:_["a"],limitsEffect:c["a"],changekefang(t,e){let s=this.roomcostProjects.filter(e=>e.code==t);e.settlement_itemname=s[0].name},changehuichang(t,e){let s=this.meetingcostProjects.filter(e=>e.code==t);e.settlement_itemname=s[0].name},changehotelnei(t,e){let s=this.foodcostProjects.filter(e=>e.code==t);e.settlement_itemname=s[0].name},openAddSettle(){this.cost_project_load=!0;let t=r()(this.info.event_startdate).subtract(3,"days").format("YYYY-MM-DD"),e=r()(this.info.event_enddate).add(1,"days").format("YYYY-MM-DD"),s=Object(n["f"])(t,e);this.costDates=[],s.forEach((t,e)=>{this.costDates.push({value:t,label:t})}),this.changeProjectClass(),this.addSettleShow=!0},changecostProject(){"zafei"==this.addSettleInfo.costProject?(this.needCostDate=!1,this.addSettleRules.costDate[0].required=!1):(this.needCostDate=!0,this.addSettleRules.costDate[0].required=!0)},async changeProjectClass(){const t={"0034":{selects:"roomcostProjects"},"0049":{selects:"meetingcostProjects"},"0050":{selects:"foodcostProjects"}};"009"==this.addSettleInfo.projectClass?this.needCostDate=!1:this.needCostDate=!0,this.cost_project_load=!0;let e=await this.$api.getCostProjects({code:this.addSettleInfo.projectClass},"POST");this.cost_project_load=!1,this[t[this.addSettleInfo.projectClass].selects]=e.map(t=>(t.value=t.code,t.label=t.name,t)),this.costProjects=e.map(t=>(t.value=t.code,t.label=t.name,t)),this.costProjects.push({label:"杂费",value:"zafei"}),this.addSettleInfo.costProject=this.costProjects[0].value},initCostProject(){this.$api.getCostProjects({code:""},"POST").then(t=>{let e=t.filter(t=>"0034"==t.event_dictionary_code),s=t.filter(t=>"0049"==t.event_dictionary_code),i=t.filter(t=>"0050"==t.event_dictionary_code),o=t.filter(t=>"0051"==t.event_dictionary_code),n=t.filter(t=>"003"==t.event_dictionary_code),l=t.filter(t=>"006"==t.event_dictionary_code),a=t.filter(t=>"009"==t.event_dictionary_code);this.roomcostProjects=e.map(t=>(t.label=t.name,t.value=t.code,t)),this.meetingcostProjects=s.map(t=>(t.label=t.name,t.value=t.code,t)),this.foodcostProjects=i.map(t=>(t.label=t.name,t.value=t.code,t)),this.otherfoodcostProjects=o.map(t=>(t.label=t.name,t.value=t.code,t)),this.transportationcostProjects=n.map(t=>(t.label=t.name,t.value=t.code,t)),this.carcostProjects=l.map(t=>(t.label=t.name,t.value=t.code,t)),this.othercostProjects=a.map(t=>(t.label=t.name,t.value=t.code,t))})},addSettle(){const t={"0034":{dataList:"roomlist",addBusinessBlock:"addroomBusiness",addDataBlock:"addroom",selects:"roomcostProjects"},"0049":{dataList:"conferencelist",addBusinessBlock:"addconferenceBusiness",addDataBlock:"addconference",selects:"meetingcostProjects"},"0050":{dataList:"foodlist",addBusinessBlock:"addfoodBusiness",addDataBlock:"addfood",selects:"foodcostProjects"}},e={"0034":1,"0049":2,"0050":3,"0051":7,"003":4,"006":5,"009":6};this.$refs.addSettleInfo.validate(s=>{if(s){let s=t[this.addSettleInfo.projectClass];if(s)if(this[s.selects]=[...this.costProjects],"zafei"==this.addSettleInfo.costProject)this.addOther(e[this.addSettleInfo.projectClass]);else if(this.info[s.dataList]&&this.info[s.dataList].length)if("009"==this.addSettleInfo.projectClass)this[s.addDataBlock](filterDate[0],!0);else{let t=this.info[s.dataList].filter(t=>this.addSettleInfo.costDate==r()(t.date).format("YYYY-MM-DD"));t&&t.length?this[s.addDataBlock](t[0],!0):this[s.addBusinessBlock](!0)}else this[s.addBusinessBlock](!0);this.addSettleShow=!1}})},excelDownload(){this.orderIDList.push(this.info.orderform_id);var t="结算单"+this.info.num;this.excelExport("/SettlementSheet/ExportExcel1",{orderIDList:this.orderIDList},t)},handleChangeAttach(t,e,s){const i=t.size/1024/1024<30;if(this.limitsEffect(t)){if(!i)return this.$message.error("上传附件大小不能超过 30MB!"),void this.arrayList.forEach((i,o)=>{s==i.type&&this.$refs.upload[o].handleRemove(t,e,s)});this.arrayList.forEach((t,i)=>{s==t.type&&(t.fileList=e)}),this.initFileRename()}else this.arrayList.forEach((i,o)=>{s==i.type&&this.$refs.upload[o].handleRemove(t,e,s)})},handleRemoveAttach(t,e,s){this.arrayList.forEach((t,i)=>{s==t.type&&(t.fileList=e)}),this.initFileRename()},handlePreview(t){if(!t.url)return;let e=t.url.substring(t.url.lastIndexOf(".")+1),s=["pdf","jpeg","jpg","png","txt"],i=["docx","doc","xls","xlsx","xlsm","ppt","pptx"];t.url=t.url.replace(/http:/,"https:"),this.downloadUrl=t.url,i.includes(e)?this.downloadUrl="https://view.officeapps.live.com/op/view.aspx?src="+encodeURIComponent(t.url):s.includes(e)?this.downloadUrl=t.url:this.$message.info("文件格式不支持预览，下载后查看"),setTimeout(()=>{this.$refs.a_click.click()},100)},initFileRename(){var t=this;this.$nextTick(()=>{var e=document.getElementsByClassName("el-upload-list__item-name")||null;Array.from(e).forEach((e,s,i)=>{var o=e.innerText;e.getElementsByTagName("span")[0]||(e.innerHTML+="<span style='color:#199ED8;cursor: pointer;'>重命名</span>"),e.getElementsByTagName("span")[0].addEventListener("click",(function(s){s.stopPropagation(),t.rename=!0,t.fileName=o.slice(0,o.lastIndexOf(".")),t.suffix=o.slice(o.lastIndexOf(".")),console.log(e.getElementsByTagName("span")[0].parentNode.parentNode.parentNode)}))})})},fileRename(t,e,s){this.rename=!0,this.updateIndex=e,this.updateFileIndex=s,this.fileName=t.name.slice(0,t.name.lastIndexOf(".")),this.suffix=t.name.slice(t.name.lastIndexOf("."))},saveFileName(){if(this.arrayList[this.updateIndex].fileList[this.updateFileIndex].name=this.fileName+this.suffix,this.info.settlement_sheet_attach.forEach((t,e)=>{t.id==this.arrayList[this.updateIndex].fileList[this.updateFileIndex].id&&(this.info.settlement_sheet_attach[e].filename=this.fileName+this.suffix)}),this.arrayList[this.updateIndex].fileList[this.updateFileIndex].raw){const t=new File([this.arrayList[this.updateIndex].fileList[this.updateFileIndex].raw],this.fileName+this.suffix,{lastModified:this.arrayList[this.updateIndex].fileList[this.updateFileIndex].raw.lastModified,lastModifiedDate:this.arrayList[this.updateIndex].fileList[this.updateFileIndex].raw.lastModifiedDate,type:this.arrayList[this.updateIndex].fileList[this.updateFileIndex].raw.type});this.arrayList[this.updateIndex].fileList[this.updateFileIndex].raw=t}this.rename=!1},deleteFile(t,e,s){this.arrayList[e].fileList.splice(s,1)},addOther(t){this.info.settlement_sheet_sundries.push({id:this.guid(),type:t,price:0,count:0,comments:"",content:"",isnotservice:!1})},delOther(t){this.info.settlement_sheet_sundries=this.info.settlement_sheet_sundries.filter(e=>e.id!=t)},async addroom(t,e){e||(this.addSettleInfo.projectClass="0034",await this.changeProjectClass()),t.room_list.push({settlement_itemid:this.addSettleInfo.costProject,roomtypename:"",totalprice:0,unitprice:0,roomcount:0,inside_roomcount:0,settlement_inside_roomcount:0,outside_roomcount:0,settlement_outside_roomcount:0,settlement_unitprice:"0",settlement_itemname:this.findCostProjectByKey(this.addSettleInfo.costProject).label,settlement_count:"0",settlement_comments:""})},findCostProjectByKey(t){let e=this.costProjects.filter(e=>t==e.value);return e&&e.length?e[0]:null},addroomBusiness(t){this.info.settlement_sheet_room.push({date:r()(this.addSettleInfo.costDate).format("YYYY/MM/DD"),room_list:[{settlement_itemid:this.addSettleInfo.costProject,roomtypename:"",totalprice:0,unitprice:0,roomcount:0,inside_roomcount:0,settlement_inside_roomcount:0,outside_roomcount:0,settlement_outside_roomcount:0,settlement_unitprice:"0",settlement_itemname:this.findCostProjectByKey(this.addSettleInfo.costProject).label,settlement_count:"0",settlement_comments:""}]}),this.info.settlement_sheet_room=this.info.settlement_sheet_room.sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime())},delroom(t,e){t.room_list.splice(e,1)},async addconference(t,e){e||(this.addSettleInfo.projectClass="0049",await this.changeProjectClass()),t.conference_list.push({settlement_itemid:this.addSettleInfo.costProject,is_important:"",price:0,count:0,settlement_price:"0",settlement_itemname:this.findCostProjectByKey(this.addSettleInfo.costProject).label,settlement_count:"1",settlement_comments:""})},addconferenceBusiness(t){this.info.settlement_sheet_conference.push({date:r()(this.addSettleInfo.costDate).format("YYYY/MM/DD"),conference_list:[{settlement_itemid:this.addSettleInfo.costProject,is_important:"",price:0,count:0,settlement_price:"0",settlement_itemname:this.findCostProjectByKey(this.addSettleInfo.costProject).label,settlement_count:"1",settlement_comments:""}]}),this.info.settlement_sheet_conference=this.info.settlement_sheet_conference.sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime())},delconference(t,e){t.conference_list.splice(e,1)},async addfood(t,e){e||(this.addSettleInfo.projectClass="0050",await this.changeProjectClass()),t.food_list.push({settlement_itemid:this.addSettleInfo.costProject,foodtypename:"",addresstype:"0",personcount:0,price:0,settlement_unitprice:"0",settlement_itemname:this.findCostProjectByKey(this.addSettleInfo.costProject).label,settlement_count:"0",settlement_comments:""})},addfoodBusiness(t){this.info.settlement_sheet_food.push({date:r()(this.addSettleInfo.costDate).format("YYYY/MM/DD"),food_list:[{settlement_itemid:this.addSettleInfo.costProject,foodtypename:"",addresstype:"0",personcount:0,price:0,settlement_unitprice:"0",settlement_itemname:this.findCostProjectByKey(this.addSettleInfo.costProject).label,settlement_count:"0",settlement_comments:""}]}),this.info.settlement_sheet_food=this.info.settlement_sheet_food.sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime())},delfood(t,e){t.food_list.splice(e,1)},addstransportation(t){t.transportation_list.push({joinname:"",passengercount:0,unitprice:0,settlement_unitprice:"0",settlement_itemname:"",settlement_count:"0",settlement_comments:""})},delstransportation(t,e){t.transportation_list.splice(e,1)},addcar(t){t.car_list.push({purposename:"",carcount:0,price:0,settlement_unitprice:"0",settlement_itemname:"",settlement_count:"0",settlement_comments:""})},delcar(t,e){t.car_list.splice(e,1)},submit(){this.validate()&&(this.arrayList[0].fileList.length||this.arrayList[1].fileList.length||this.arrayList[2].fileList.length||this.arrayList[3].fileList.length?(this.info.settlement_status!=this.status_confirm&&(this.info.settlement_status=this.status_tobeconfirmed),this.save()):this.$message.error("请上传酒店住宿发票+小联、酒店餐饮发票+小联、酒店会场发票+小联、其他"))},draft(){this.validate()&&(this.arrayList[0].fileList.length||this.arrayList[1].fileList.length||this.arrayList[2].fileList.length||this.arrayList[3].fileList.length?(this.info.settlement_status=this.status_draft,this.save()):this.$message.error("请上传酒店住宿发票+小联、酒店餐饮发票+小联、酒店会场发票+小联、其他"))},differenceShowErrorMessage:function(){let t="";this.errormsg.forEach(e=>{t+="<p style='padding:5px;'>"+e+"</p>"}),this.$message({message:t,dangerouslyUseHTMLString:!0,type:"error",lockScroll:!1})},validate:function(){return this.errormsg=[],this.checkRoomDifference,this.checkConferenceDifference,this.checkFoodDifference,this.checkTransportationDifference,this.checkCarDifference,this.checkOtherDifference,this.errormsg.length>0&&this.differenceShowErrorMessage(),0==this.errormsg.length},save(){this.info.pre_settlement_status===this.status_reject&&(this.info.settlement_sheet_id=null),this.info.settlement_voucher=this.arrayList[0].remark,this.info.settlement_contract=this.arrayList[1].remark,this.info.settlement_waterbill=this.arrayList[2].remark,this.info.settlement_other=this.arrayList[3].remark,this.info.settlement_invoice=this.arrayList[4].remark;let t=[{urLs:[]},{urLs:[]},{urLs:[]},{urLs:[]},{urLs:[]}];t.forEach((t,e)=>{if(this.arrayList[e]){this.arrayList[e].fileList.filter(t=>""!=t.uid);this.arrayList[e].fileList.length>0&&this.arrayList[e].fileList.forEach(e=>{t.urLs.push({key:e.uid,file:e.raw})})}}),Object(l["a"])(t[0].urLs).then(e=>(this.info.settlement_sheet_attach&&this.info.settlement_sheet_attach.length>0&&this.info.settlement_sheet_attach.forEach(t=>{0==this.arrayList[0].fileList.filter(e=>e.id==t.id).length&&t.filetype==this.arrayList[0].type&&(t.delete=!0)}),e.forEach(t=>{t&&this.info.settlement_sheet_attach.push({filetype:this.arrayList[0].type,filepath:t.FilePath,filename:t.OriginalFileName})}),Object(l["a"])(t[1].urLs))).then(e=>(this.info.settlement_sheet_attach&&this.info.settlement_sheet_attach.length>0&&this.info.settlement_sheet_attach.forEach(t=>{0==this.arrayList[1].fileList.filter(e=>e.id==t.id).length&&t.filetype==this.arrayList[1].type&&(t.delete=!0)}),e.forEach(t=>{t&&this.info.settlement_sheet_attach.push({filetype:this.arrayList[1].type,filepath:t.FilePath,filename:t.OriginalFileName})}),Object(l["a"])(t[2].urLs))).then(e=>(this.info.settlement_sheet_attach&&this.info.settlement_sheet_attach.length>0&&this.info.settlement_sheet_attach.forEach(t=>{0==this.arrayList[2].fileList.filter(e=>e.id==t.id).length&&t.filetype==this.arrayList[2].type&&(t.delete=!0)}),e.forEach(t=>{t&&this.info.settlement_sheet_attach.push({filetype:this.arrayList[2].type,filepath:t.FilePath,filename:t.OriginalFileName})}),Object(l["a"])(t[3].urLs))).then(e=>(this.info.settlement_sheet_attach&&this.info.settlement_sheet_attach.length>0&&this.info.settlement_sheet_attach.forEach(t=>{0==this.arrayList[3].fileList.filter(e=>e.id==t.id).length&&t.filetype==this.arrayList[3].type&&(t.delete=!0)}),e.forEach(t=>{t&&this.info.settlement_sheet_attach.push({filetype:this.arrayList[3].type,filepath:t.FilePath,filename:t.OriginalFileName})}),Object(l["a"])(t[4].urLs))).then(t=>(this.info.settlement_sheet_attach&&this.info.settlement_sheet_attach.length>0&&this.info.settlement_sheet_attach.forEach(t=>{0==this.arrayList[4].fileList.filter(e=>e.id==t.id).length&&t.filetype==this.arrayList[4].type&&(t.delete=!0)}),t.forEach(t=>{t&&this.info.settlement_sheet_attach.push({filetype:this.arrayList[4].type,filepath:t.FilePath,filename:t.OriginalFileName})}),this.info.settlement_sheet_room&&this.info.settlement_sheet_room.forEach(t=>{for(let e=0;e<t.room_list.length;e++)t.room_list[e].indexs=e+1}),this.info.settlement_sheet_conference&&this.info.settlement_sheet_conference.forEach(t=>{for(let e=0;e<t.conference_list.length;e++)t.conference_list[e].indexs=e+1}),this.info.settlement_sheet_food&&this.info.settlement_sheet_food.forEach(t=>{for(let e=0;e<t.food_list.length;e++)t.food_list[e].indexs=e+1}),this.$api.settlementsheetSave(this.info,"POST"))).then(t=>{t?(this.$message({message:"保存成功！",type:"success"}),this.$router.push({name:"orderInfo_Hotel",params:{id:this.info.orderform_id}})):this.$message({message:"保存失败！",type:"error"})})},initVat(){this.info.taxlist.forEach((t,e)=>{t.id==this.info.roomtaxid&&(this.roomOut=t.outtaxrate,this.roomOutMsg=t.taxname),t.id==this.info.conferencetaxid&&(this.conferenceOut=t.outtaxrate,this.conferenceOutMsg=t.taxname),t.id==this.info.foodtaxid&&(this.foodOut=t.outtaxrate,this.foodOutMsg=t.taxname),t.id==this.info.settlement_roomtaxid&&(this.roomSettlementOut=t.outtaxrate),t.id==this.info.settlement_conferencetaxid&&(this.conferenceSettlementOut=t.outtaxrate),t.id==this.info.settlement_foodtaxid&&(this.foodSettlementOut=t.outtaxrate)})},roomVat(t){this.info.taxlist.forEach((e,s)=>{e.id==t&&(this.roomSettlementOut=e.outtaxrate)}),this.info.roomtaxid=t},conferenceVat(t){this.info.taxlist.forEach((e,s)=>{e.id==t&&(this.conferenceSettlementOut=e.outtaxrate)}),this.info.conferencetaxid=t},foodVat(t){this.info.taxlist.forEach((e,s)=>{e.id==t&&(this.foodSettlementOut=e.outtaxrate)}),this.info.foodtaxid=t},initInfo(){this.info.settlement_sheet_room.forEach((t,e)=>{t.room_list.forEach(t=>{t.settlement_sheet_room_id||(t.settlement_unitprice=Object(n["o"])(t.unitprice),"0"==this.info.is_Inside_outside&&(t.settlement_count=t.provide_count,t.settlement_inside_roomcount=0,t.settlement_outside_roomcount=t.provide_count),"1"==this.info.is_Inside_outside&&(t.settlement_count=t.provide_count,t.settlement_inside_roomcount=t.inside_roomcount,t.settlement_outside_roomcount=t.outside_roomcount))})}),this.info.settlement_sheet_conference.forEach((t,e)=>{t.conference_list.forEach(t=>{t.settlement_sheet_conference_id||(t.settlement_price=Object(n["o"])(t.price),t.settlement_count=Object(n["m"])(t.count))})}),this.info.settlement_sheet_food.forEach((t,e)=>{t.food_list.forEach(t=>{t.settlement_sheet_food_id||(t.settlement_unitprice=Object(n["o"])(t.price),t.settlement_count=Object(n["m"])(t.personcount))})})}},mounted(){this.initCostProject(),this.$api.settlementsheetInfo({id:this.$route.params.id},"POST").then(t=>{this.info=t,this.initVat(),this.initInfo(),this.info.settlement_sheet_attach&&this.info.settlement_sheet_attach.length>0&&this.info.settlement_sheet_attach.forEach(t=>{this.arrayList.forEach((e,s)=>{t.filetype==e.type&&this.arrayList[s].fileList.push({id:t.id,uid:"",name:t.filename,url:this.info.domain+t.filepath})})}),this.arrayList[0].remark=this.info.settlement_voucher,this.arrayList[1].remark=this.info.settlement_contract,this.arrayList[2].remark=this.info.settlement_waterbill,this.arrayList[3].remark=this.info.settlement_other,this.arrayList[4].remark=this.info.settlement_invoice,this.info.dissent_invoice&&(this.arrayList[0].dissent=this.info.dissent_voucher,this.arrayList[1].dissent=this.info.dissent_contract,this.arrayList[2].dissent=this.info.dissent_waterbill,this.arrayList[3].dissent=this.info.dissent_other,this.arrayList[4].dissent=this.info.dissent_invoice),this.initFileRename()})}}),m=d,f=(s("3160"),s("0b56")),h=Object(f["a"])(m,i,o,!1,null,"42c0da02",null);e["default"]=h.exports},d4df:function(t,e,s){}}]);