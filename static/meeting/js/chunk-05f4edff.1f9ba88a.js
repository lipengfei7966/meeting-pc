(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-05f4edff"],{"147a":function(t,e,n){},"1fbd":function(t,e,n){"use strict";n("147a")},6941:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.info?n("div",{staticClass:"orderInfo"},[n("div",{staticClass:"title"},[t._v(" 我的订单 - 结算单 - "),t.info?[t._v(" "+t._s(t.info.num)+" ")]:t._e()],2),n("a",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"a_click",attrs:{href:t.downloadUrl,target:"_blank",download:""}}),t.info?n("div",{staticClass:"content"},[t.info.settlement_status===t.status_draft?n("div",{staticClass:"tips"},[n("p",[t._v("该草稿保存于"+t._s(t.info.settlement_submit_time))])]):t._e(),n("div",{staticClass:"step"},[t._v(" Step1 确认订单基本信息 "),n("p",{staticStyle:{color:"#428bca","font-size":"17px",float:"right"}},[0==this.$route.params.issubmit?n("a",{staticStyle:{cursor:"pointer",margin:"0 10px"},attrs:{download:""},on:{click:t.excelDownload}},[t._v("下载结算Excel")]):t._e()])]),n("div",{staticClass:"info"},[n("div",{staticClass:"line"},[n("div",{staticClass:"item"},[n("div",{staticClass:"label"},[t._v("订单号")]),n("div",{staticClass:"context"},[t._v(t._s(t.info.num))])]),n("div",{staticClass:"item"},[n("div",{staticClass:"label"},[t._v("联系人")]),n("div",{staticClass:"context"},[t._v(t._s(t.info.contacts))])])]),n("div",{staticClass:"line"},[n("div",{staticClass:"item"},[n("div",{staticClass:"label"},[t._v("下单时间")]),n("div",{staticClass:"context"},[t._v(t._s(t._f("date_ex")(t.info.submit_time)))])]),n("div",{staticClass:"item"},[n("div",{staticClass:"label"},[t._v("联系方式")]),n("div",{staticClass:"context"},[t._v(t._s(t.info.customer_service_telephone_numbers))])])]),n("div",{staticClass:"line"},[n("div",{staticClass:"item"},[n("div",{staticClass:"label"},[t._v("活动名称")]),n("div",{staticClass:"context"},[t._v(t._s(t.info.activity_name))])]),n("div",{staticClass:"item"},[n("div",{staticClass:"label"},[t._v("客户名称")]),n("div",{staticClass:"context"},[t._v(t._s(t.info.company_name))])])]),n("div",{staticClass:"line"},[n("div",{staticClass:"item"},[n("div",{staticClass:"label"},[t._v("活动日期")]),n("div",{staticClass:"context"},[t._v(t._s(t.info.activity_date))])]),n("div",{staticClass:"item"},[n("div",{staticClass:"label"},[t._v("报价日期")]),n("div",{staticClass:"context"},[t._v(t._s(t._f("date_ex")(t.info.offer_data)))])])])]),n("div",{staticClass:"step"},[t._v("Step2 上传结算相关凭证（必填）")]),n("table",[t._m(0),t._l(t.arrayList,(function(e,o){return n("tbody",[4!=o?n("tr",[n("td",[t._v(t._s(e.name))]),n("td",[n("el-upload",{ref:"upload",refInFor:!0,attrs:{action:"","on-change":function(n,o){t.handleChangeAttach(n,o,t.type=e.type)},"on-remove":function(n,o){t.handleRemoveAttach(n,o,t.type=e.type)},"on-preview":t.handlePreview,"auto-upload":!1,"file-list":e.fileList,"show-file-list":!1,multiple:!1,disabled:t.isconfirm}},[!t.isconfirm||t.issupplement?n("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("从电脑选择文件")]):t._e(),n("ul",{staticStyle:{"margin-top":"5px"}},t._l(e.fileList,(function(e,i){return n("li",{key:i,staticClass:"pitchOn",on:{click:function(n){return t.handlePreview(e)}}},[n("span",[t._v(t._s(e.name))]),n("span",{staticStyle:{color:"#199ED8",cursor:"pointer","margin-left":"30px"},on:{click:function(n){return n.stopPropagation(),t.fileRename(e,o,i)}}},[t._v("重命名")]),n("span",{staticStyle:{color:"#199ED8",cursor:"pointer","margin-left":"10px"},on:{click:function(n){return n.stopPropagation(),t.deleteFile(e,o,i)}}},[t._v("删除")])])})),0)],1),n("el-dialog",{attrs:{"close-on-click-modal":!1,visible:t.rename,title:"请输入附件名称",width:"500px"},on:{"update:visible":function(e){t.rename=e}}},[n("el-input",{attrs:{placeholder:"请输入名称"},model:{value:t.fileName,callback:function(e){t.fileName=e},expression:"fileName"}},[n("template",{slot:"append"},[t._v(" "+t._s(t.suffix)+" ")])],2),n("span",{staticClass:"dialog-footer flex_row justify_center mar_t20",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.saveFileName()}}},[t._v("保存")])],1)],1)],1),n("td",[t._v(t._s(e.dissent))]),n("td",[n("el-input",{attrs:{readonly:t.isconfirm},model:{value:e.remark,callback:function(n){t.$set(e,"remark",n)},expression:"item.remark"}})],1)]):t._e(),t.isconfirm&&4==o?n("tr",[n("td",[t._v(t._s(e.name))]),n("td",[n("el-upload",{ref:"upload",refInFor:!0,attrs:{action:"","on-change":function(n,o){t.handleChangeAttach(n,o,t.type=e.type)},"on-remove":function(n,o){t.handleRemoveAttach(n,o,t.type=e.type)},"on-preview":t.handlePreview,"auto-upload":!1,"file-list":e.fileList,"show-file-list":!1,multiple:!1,disabled:!t.isconfirm}},[t.isconfirm?n("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("从电脑选择文件")]):t._e(),n("ul",{staticStyle:{"margin-top":"5px"}},t._l(e.fileList,(function(e,i){return n("li",{key:i,staticClass:"pitchOn",on:{click:function(n){return t.handlePreview(e)}}},[n("span",[t._v(t._s(e.name))]),n("span",{staticStyle:{color:"#199ED8",cursor:"pointer","margin-left":"30px"},on:{click:function(n){return n.stopPropagation(),t.fileRename(e,o,i)}}},[t._v("重命名")]),n("span",{staticStyle:{color:"#199ED8",cursor:"pointer","margin-left":"10px"},on:{click:function(n){return n.stopPropagation(),t.deleteFile(e,o,i)}}},[t._v("删除")])])})),0)],1),n("el-dialog",{attrs:{"close-on-click-modal":!1,visible:t.rename,title:"请输入附件名称",width:"500px"},on:{"update:visible":function(e){t.rename=e}}},[n("el-input",{attrs:{placeholder:"请输入名称"},model:{value:t.fileName,callback:function(e){t.fileName=e},expression:"fileName"}},[n("template",{slot:"append"},[t._v(" "+t._s(t.suffix)+" ")])],2),n("span",{staticClass:"dialog-footer flex_row justify_center mar_t20",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.saveFileName()}}},[t._v("保存")])],1)],1)],1),n("td",[t._v(t._s(e.dissent))]),n("td",[n("el-input",{attrs:{readonly:t.readonly},model:{value:e.remark,callback:function(n){t.$set(e,"remark",n)},expression:"item.remark"}})],1)]):t._e()])}))],2),n("div",{staticClass:"step"},[t._v("Step3 填写结算明细（必填）")]),n("table",[n("thead",[n("tr",{staticClass:"color_2"},[n("th",{staticClass:"color_3",attrs:{colspan:"4"}},[t._v("原订单总报价：¥"+t._s(t.positiveFloat(t.price_no[0])))]),n("th",{staticStyle:{position:"relative"},attrs:{colspan:"5"}},[t._v("订单总结算价：¥"+t._s(t.positiveFloat(t.price_no[1]))+" "),t.readonly?t._e():n("div",{staticClass:"add_settle"},[n("el-button",{staticClass:"el-icon-folder-add",attrs:{type:"primary",size:"mini"},on:{click:t.openAddSettle}},[t._v("添加结算项目")])],1)])])]),t.roomVisible?n("tbody",[n("tr",{staticClass:"color_2"},[t._m(1),n("th",{staticClass:"color_3",staticStyle:{"text-align":"right"},attrs:{colspan:"3"}},[t._v(" 报价金额：¥"+t._s(t.positiveFloat(t.roomPrice[0].all*t.roomOut))+" "),n("p",{staticStyle:{color:"#999"}},[t._v(t._s(t.roomOutMsg))])]),n("th",{staticStyle:{"text-align":"right"},attrs:{colspan:"4"}},[t._v(" 结算金额：¥"+t._s(t.positiveFloat(t.roomPrice[1].all*t.roomSettlementOut))+" "),n("el-select",{attrs:{disabled:t.readonly,size:"mini",placeholder:"请选择"},on:{change:function(e){return t.roomVat(e)}},model:{value:t.info.settlement_roomtaxid,callback:function(e){t.$set(t.info,"settlement_roomtaxid",e)},expression:"info.settlement_roomtaxid"}},t._l(t.info.taxlist,(function(t){return n("el-option",{key:t.id,attrs:{label:t.taxname,value:t.id}})})),1)],1),n("th")])]):t._e(),t._l(t.info.settlement_sheet_room,(function(e,o){return n("tbody",{key:"kefang"+o},[n("tr",{staticClass:"color_2"},[n("th",{staticClass:"color_3"},[n("i",[t._v(t._s(t._f("date_day_ex")(e.date)))])]),n("th",{staticClass:"color_3",staticStyle:{"text-align":"right"},attrs:{colspan:"3"}},[t._v("小计：¥"+t._s(t.positiveFloat(t.roomPrice[0].subtotal["sub_"+o]*t.roomOut)))]),n("th",{staticStyle:{"text-align":"right"},attrs:{colspan:"4"}},[t._v("小计：¥"+t._s(t.positiveFloat(t.roomPrice[1].subtotal["sub_"+o]*t.roomSettlementOut)))]),n("th",[t.issubmit?n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){return t.addroom(e)}}},[t._v("添加客房")]):t._e()],1)]),n("tr",{staticClass:"color_2"},[n("th",{staticClass:"color_3"},[t._v("消费项目")]),n("th",{staticClass:"color_3"},[t._v("单价(元)")]),n("th",{staticClass:"color_3"},[t._v("数量")]),n("th",{staticClass:"color_3"},[t._v("金额(元)")]),n("th",[t._v("单价(元)")]),"0"==t.info.is_Inside_outside?n("th",[t._v("数量")]):t._e(),"1"==t.info.is_Inside_outside?n("th",[t._v("内部间数 外部间数")]):t._e(),n("th",[t._v("金额(元)")]),n("th",[t._v("客户异议")]),n("th",[t._v("结算说明")])]),t._l(e.room_list,(function(o,i){return n("tr",{key:"room"+i,class:{difference:o.difference}},[n("td",{staticClass:"color_2"},[o.quoted_price_room_id?[t._v(" "+t._s(o.roomtypename)+" ")]:[n("el-select",{attrs:{loading:t.cost_project_load,size:"small",filterable:""},on:{change:function(e){return t.changekefang(e,o)}},model:{value:o.settlement_itemid,callback:function(e){t.$set(o,"settlement_itemid",e)},expression:"room.settlement_itemid"}},t._l(t.roomcostProjects,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],o.quoted_price_room_id&&(o.otherrequirements||o.remarks)?n("el-tooltip",{staticClass:"describe-tooltip",attrs:{effect:"dark",placement:"top-end"}},[n("div",{staticStyle:{width:"150px"},attrs:{slot:"content"},slot:"content"},[o.otherrequirements?n("div",[t._v("需求说明："+t._s(o.otherrequirements))]):t._e(),o.remarks?n("div",[t._v("报价备注："+t._s(o.remarks))]):t._e()]),n("el-button",{attrs:{type:"text"}},[t._v("备注")])],1):t._e()],2),n("td",{staticClass:"color_2"},[t._v(t._s(t.positiveFloat(o.unitprice)))]),n("td",{staticClass:"color_2"},["0"==t.info.is_Inside_outside?n("p",[t._v(t._s(o.provide_count))]):t._e(),"1"==t.info.is_Inside_outside?n("div",[n("p",[t._v("内部人员："+t._s(o.inside_roomcount))]),n("p",[t._v("外部人员："+t._s(o.outside_roomcount))])]):t._e()]),n("td",{staticClass:"color_2"},[t._v(t._s(t.positiveFloat(o.totalprice)))]),n("td",[n("el-input",{attrs:{type:"text",readonly:t.readonly},on:{input:function(e){o.settlement_unitprice=t.formatNum(o.settlement_unitprice,2)}},model:{value:o.settlement_unitprice,callback:function(e){t.$set(o,"settlement_unitprice",e)},expression:"room.settlement_unitprice"}})],1),n("td",["0"==t.info.is_Inside_outside?n("el-input",{class:{lineBack:!!o.lineoroffline},staticStyle:{width:"50%"},attrs:{placeholder:"请输入数量",readonly:t.readonly||!!o.lineoroffline},on:{input:function(e){o.settlement_count=t.formatNum(o.settlement_count,3)}},model:{value:o.settlement_count,callback:function(e){t.$set(o,"settlement_count",e)},expression:"room.settlement_count"}}):t._e(),"1"==t.info.is_Inside_outside?n("div",{staticStyle:{display:"flex"}},[n("el-input",{class:{lineBack:!!o.lineoroffline},staticStyle:{width:"55%"},attrs:{placeholder:"请输入数量",readonly:t.readonly||!!o.lineoroffline},on:{input:function(e){o.settlement_inside_roomcount=t.formatNum(o.settlement_inside_roomcount,3),o.settlement_count=t.positiveFloat(o.settlement_inside_roomcount)+t.positiveFloat(o.settlement_outside_roomcount)}},model:{value:o.settlement_inside_roomcount,callback:function(e){t.$set(o,"settlement_inside_roomcount",e)},expression:"room.settlement_inside_roomcount"}}),n("el-input",{class:{lineBack:!!o.lineoroffline},staticStyle:{width:"55%","margin-left":"10px"},attrs:{placeholder:"请输入数量",readonly:t.readonly||!!o.lineoroffline},on:{input:function(e){o.settlement_outside_roomcount=t.formatNum(o.settlement_outside_roomcount,3),o.settlement_count=t.positiveFloat(o.settlement_inside_roomcount)+t.positiveFloat(o.settlement_outside_roomcount)}},model:{value:o.settlement_outside_roomcount,callback:function(e){t.$set(o,"settlement_outside_roomcount",e)},expression:"room.settlement_outside_roomcount"}})],1):t._e()],1),n("td",[t._v(t._s(t.positiveFloat(t.positiveFloatSix(o.settlement_unitprice)*t.positiveFloat(o.settlement_count))))]),n("td",[t._v(t._s(o.settlement_customer_objection))]),n("td",[n("el-input",{class:{difference:t.roomDifference(o),line:!o.quoted_price_room_id},attrs:{readonly:t.readonly},model:{value:o.settlement_comments,callback:function(e){t.$set(o,"settlement_comments",e)},expression:"room.settlement_comments"}}),!o.quoted_price_room_id&&t.issubmit?n("el-button",{attrs:{icon:"el-icon-delete",type:"danger",circle:"",size:"mini"},on:{click:function(n){return t.delroom(e,i)}}}):t._e()],1)])}))],2)})),t.roomVisible?n("tbody",[n("tr",{staticClass:"color_2"},[n("th",{staticClass:"color_3"},[t._v("杂费小计")]),n("th",{staticClass:"color_3"}),n("th",{staticClass:"color_3"}),n("th",{staticClass:"color_3"}),n("th"),n("th"),n("th",{staticStyle:{"text-align":"right"}},[t._v("¥"+t._s(t.positiveFloat(t.roomPrice[2]*t.roomSettlementOut)))]),n("th"),n("th",[t.issubmit?n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addOther(1)}}},[t._v("添加杂费")]):t._e()],1)]),t._l(t.roomincidental,(function(e){return n("tr",{key:e.id},[n("td",{staticClass:"color_2"},[n("el-input",{attrs:{readonly:t.readonly,placeholder:"杂费项名称"},model:{value:e.content,callback:function(n){t.$set(e,"content",n)},expression:"roomzf.content"}})],1),n("td",{staticClass:"color_2"}),n("td",{staticClass:"color_2"}),n("td",{staticClass:"color_2"}),n("td",[n("el-input",{attrs:{readonly:t.readonly},on:{input:function(n){e.price=t.formatNum(e.price,2)}},model:{value:e.price,callback:function(n){t.$set(e,"price",n)},expression:"roomzf.price"}})],1),n("td",[n("el-input",{attrs:{readonly:t.readonly},on:{input:function(n){e.count=t.positiveFloatOne(e.count)}},model:{value:e.count,callback:function(n){t.$set(e,"count",n)},expression:"roomzf.count"}})],1),n("td",[t._v(t._s(t.positiveFloat(t.positiveFloatSix(e.price)*t.positiveFloat(e.count))))]),n("td",{staticClass:"color_2"}),n("td",[n("el-input",{staticClass:"line",attrs:{readonly:t.readonly},model:{value:e.comments,callback:function(n){t.$set(e,"comments",n)},expression:"roomzf.comments"}}),t.issubmit?n("el-button",{attrs:{icon:"el-icon-delete",type:"danger",circle:"",size:"mini"},on:{click:function(n){return t.delOther(e.id)}}}):t._e()],1)])}))],2):t._e(),t.conferenceVisible?n("tbody",[n("tr",{staticClass:"color_2"},[t._m(2),n("th",{staticClass:"color_3",staticStyle:{"text-align":"right"},attrs:{colspan:"3"}},[t._v(" 报价金额：¥"+t._s(t.positiveFloat(t.conferencePrice[0].all*t.conferenceOut))+" "),n("p",{staticStyle:{color:"#999"}},[t._v(t._s(t.conferenceOutMsg))])]),n("th",{staticStyle:{"text-align":"right"},attrs:{colspan:"4"}},[t._v(" 结算金额：¥"+t._s(t.positiveFloat(t.conferencePrice[1].all*t.conferenceSettlementOut))+" "),n("el-select",{attrs:{disabled:t.readonly,size:"mini",placeholder:"请选择"},on:{change:function(e){return t.conferenceVat(e)}},model:{value:t.info.settlement_conferencetaxid,callback:function(e){t.$set(t.info,"settlement_conferencetaxid",e)},expression:"info.settlement_conferencetaxid"}},t._l(t.info.taxlist,(function(t){return n("el-option",{key:t.id,attrs:{label:t.taxname,value:t.id}})})),1)],1),n("th")])]):t._e(),t._l(t.info.settlement_sheet_conference,(function(e,o){return n("tbody",{key:"huiyi"+o},[n("tr",{staticClass:"color_2"},[n("th",{staticClass:"color_3"},[n("i",[t._v(t._s(t._f("date_day_ex")(e.date)))])]),n("th",{staticClass:"color_3",staticStyle:{"text-align":"right"},attrs:{colspan:"3"}},[t._v("小计：¥"+t._s(t.positiveFloat(t.conferencePrice[0].subtotal["sub_"+o])))]),n("th",{staticStyle:{"text-align":"right"},attrs:{colspan:"4"}},[t._v("小计：¥"+t._s(t.positiveFloat(t.conferencePrice[1].subtotal["sub_"+o])))]),n("th",[t.issubmit?n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){return t.addconference(e)}}},[t._v("添加会场")]):t._e()],1)]),t._m(3,!0),t._l(e.conference_list,(function(o,i){return n("tr",{key:"conference"+i},[n("td",{staticClass:"color_2"},[o.quoted_price_conference_id?[1==o.type?[t._v(" "+t._s("场租-会场"+o.order_name+"("+o.roomsetuptypename+";会议时间:"+o.starttime+"~"+o.endtime+";出席人数:"+o.attendees+"人)")+" ")]:t._e(),2==o.type?[t._v(" "+t._s("会场搭建费-"+o.related_information+" ("+o.roomsetuptypename+")")+" ")]:t._e(),3==o.type?[t._v(" "+t._s("设备-会场"+o.order_name+"("+o.roomsetuptypename+";"+o.equipment+")")+" ")]:t._e(),4==o.type?[t._v(" "+t._s(o.settlement_itemname)+" ")]:t._e()]:[n("el-select",{attrs:{loading:t.cost_project_load,size:"small",filterable:""},on:{change:function(e){return t.changehuichang(e,o)}},model:{value:o.settlement_itemid,callback:function(e){t.$set(o,"settlement_itemid",e)},expression:"conference.settlement_itemid"}},t._l(t.meetingcostProjects,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],o.quoted_price_conference_id&&(o.describe||o.comments)?n("el-tooltip",{staticClass:"describe-tooltip",attrs:{effect:"dark",placement:"top-end"}},[n("div",{staticStyle:{width:"150px"},attrs:{slot:"content"},slot:"content"},[o.describe?n("div",[t._v("需求说明："+t._s(o.describe))]):t._e(),o.comments?n("div",[t._v("报价备注："+t._s(o.comments))]):t._e()]),n("el-button",{attrs:{type:"text"}},[t._v("备注")])],1):t._e()],2),n("td",{staticClass:"color_2"},[t._v(t._s(t.positiveFloat(o.price)))]),n("td",{staticClass:"color_2"},[t._v(t._s(o.count))]),n("td",{staticClass:"color_2"},[t._v(t._s(t.positiveFloat(t.positiveFloat(o.count)*t.positiveFloatSix(o.price))))]),n("td",[n("el-input",{attrs:{type:"text",readonly:t.readonly},on:{input:function(e){o.settlement_price=t.formatNum(o.settlement_price,2)}},model:{value:o.settlement_price,callback:function(e){t.$set(o,"settlement_price",e)},expression:"conference.settlement_price"}})],1),n("td",[n("el-input",{class:{lineBack:!!o.lineoroffline},staticStyle:{width:"50%"},attrs:{placeholder:"请输入数量",readonly:t.readonly||!!o.lineoroffline},on:{input:function(e){o.settlement_count=t.formatNum(o.settlement_count,2)}},model:{value:o.settlement_count,callback:function(e){t.$set(o,"settlement_count",e)},expression:"conference.settlement_count"}})],1),n("td",[t._v(t._s(t.positiveFloat(t.positiveFloatSix(o.settlement_price)*t.positiveFloat(o.settlement_count))))]),n("td",[t._v(t._s(o.settlement_customer_objection))]),n("td",[n("el-input",{class:{difference:t.conferenceDifference(o),line:!o.quoted_price_conference_id},attrs:{readonly:t.readonly},model:{value:o.settlement_comments,callback:function(e){t.$set(o,"settlement_comments",e)},expression:"conference.settlement_comments"}}),!o.quoted_price_conference_id&&t.issubmit?n("el-button",{attrs:{icon:"el-icon-delete",type:"danger",circle:"",size:"mini"},on:{click:function(n){return t.delconference(e,i)}}}):t._e()],1)])}))],2)})),t.conferenceVisible?n("tbody",[n("tr",{staticClass:"color_2"},[n("th",{staticClass:"color_3"},[t._v("杂费小计")]),n("th",{staticClass:"color_3"}),n("th",{staticClass:"color_3"}),n("th",{staticClass:"color_3"}),n("th",[t._v("单价（元）")]),n("th",[t._v("数量")]),n("th",{staticStyle:{"text-align":"right"}},[t._v("¥"+t._s(t.positiveFloat(t.conferencePrice[2]*t.conferenceSettlementOut)))]),n("th"),n("th",[t.issubmit?n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addOther(2)}}},[t._v("添加杂费")]):t._e()],1)]),t._l(t.meetingcidental,(function(e){return n("tr",{key:e.id},[n("td",{staticClass:"color_2"},[n("el-input",{attrs:{readonly:t.readonly,placeholder:"杂费项名称"},model:{value:e.content,callback:function(n){t.$set(e,"content",n)},expression:"conferencezf.content"}})],1),n("td",{staticClass:"color_2"}),n("td",{staticClass:"color_2"}),n("td",{staticClass:"color_2"}),n("td",[n("el-input",{attrs:{type:"text",readonly:t.readonly},on:{input:function(n){e.price=t.formatNum(e.price,2)}},model:{value:e.price,callback:function(n){t.$set(e,"price",n)},expression:"conferencezf.price"}})],1),n("td",[n("el-input",{attrs:{readonly:t.readonly},on:{input:function(n){e.count=t.positiveFloatOne(e.count)}},model:{value:e.count,callback:function(n){t.$set(e,"count",n)},expression:"conferencezf.count"}})],1),n("td",[t._v(t._s(t.positiveFloat(t.positiveFloatSix(e.price)*t.positiveFloat(e.count))))]),n("td",{staticClass:"color_2"}),n("td",[n("el-input",{staticClass:"line",attrs:{readonly:t.readonly},model:{value:e.comments,callback:function(n){t.$set(e,"comments",n)},expression:"conferencezf.comments"}}),t.issubmit?n("el-button",{attrs:{icon:"el-icon-delete",type:"danger",circle:"",size:"mini"},on:{click:function(n){return t.delOther(e.id)}}}):t._e()],1)])}))],2):t._e(),t.foodVisible?n("tbody",[n("tr",{staticClass:"color_2"},[t._m(4),n("th",{staticClass:"color_3",staticStyle:{"text-align":"right"},attrs:{colspan:"3"}},[t._v(" 报价金额：¥"+t._s(t.positiveFloat(t.foodPrice[0].all*t.foodOut))+" "),n("p",{staticStyle:{color:"#999"}},[t._v(t._s(t.foodOutMsg))])]),n("th",{staticStyle:{"text-align":"right"},attrs:{colspan:"4"}},[t._v(" 结算金额：¥"+t._s(t.positiveFloat(t.foodPrice[1].all*t.foodSettlementOut))+" "),n("el-select",{attrs:{disabled:t.readonly,size:"mini",placeholder:"请选择"},on:{change:function(e){return t.foodVat(e)}},model:{value:t.info.settlement_foodtaxid,callback:function(e){t.$set(t.info,"settlement_foodtaxid",e)},expression:"info.settlement_foodtaxid"}},t._l(t.info.taxlist,(function(t){return n("el-option",{key:t.id,attrs:{label:t.taxname,value:t.id}})})),1)],1),n("th")])]):t._e(),t._l(t.info.settlement_sheet_food,(function(e,o){return n("tbody",{key:"canyin"+o},[n("tr",{staticClass:"color_2"},[n("th",{staticClass:"color_3"},[n("i",[t._v(t._s(t._f("date_day_ex")(e.date)))])]),n("th",{staticClass:"color_3",staticStyle:{"text-align":"right"},attrs:{colspan:"3"}},[t._v("小计：¥"+t._s(t.positiveFloat(t.foodPrice[0].subtotal["sub_"+o]*t.foodOut)))]),n("th",{staticStyle:{"text-align":"right"},attrs:{colspan:"4"}},[t._v("小计：¥"+t._s(t.positiveFloat(t.foodPrice[1].subtotal["sub_"+o]*t.foodSettlementOut)))]),n("th",[t.issubmit?n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){return t.addfood(e)}}},[t._v("添加餐饮")]):t._e()],1)]),t._m(5,!0),t._l(e.food_list,(function(o,i){return n("tr",{key:"food"+i},[n("td",{staticClass:"color_2"},[o.quoted_price_food_id?[t._v(" "+t._s(o.foodtypename)+" "),o.usetypename?n("span",[t._v("["+t._s(o.usetypename)+"]")]):t._e()]:[n("el-select",{attrs:{loading:t.cost_project_load,size:"small",filterable:""},on:{change:function(e){return t.changehotelnei(e,o)}},model:{value:o.settlement_itemid,callback:function(e){t.$set(o,"settlement_itemid",e)},expression:"food.settlement_itemid"}},t._l(t.foodcostProjects,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],o.quoted_price_food_id&&(o.comments||o.offer_remarks)?n("el-tooltip",{staticClass:"describe-tooltip",attrs:{effect:"dark",placement:"top-end"}},[n("div",{staticStyle:{width:"150px"},attrs:{slot:"content"},slot:"content"},[o.comments?n("div",[t._v("需求说明："+t._s(o.comments))]):t._e(),o.offer_remarks?n("div",[t._v("报价备注："+t._s(o.offer_remarks))]):t._e()]),n("el-button",{attrs:{type:"text"}},[t._v("备注")])],1):t._e()],2),n("td",{staticClass:"color_2"},[o.quoted_price_food_id||!o.quoted_price_food_id&&o.settlement_itemid?[t._v(" "+t._s(t.positiveFloat(o.price))+" ")]:t._e()],2),n("td",{staticClass:"color_2"},[t._v(t._s(o.personcount))]),n("td",{staticClass:"color_2"},[t._v(t._s(t.positiveFloat(t.positiveFloat(o.personcount)*t.positiveFloatSix(o.price))))]),n("td",[n("el-input",{attrs:{readonly:t.readonly},on:{input:function(e){o.settlement_unitprice=t.formatNum(o.settlement_unitprice)}},model:{value:o.settlement_unitprice,callback:function(e){t.$set(o,"settlement_unitprice",e)},expression:"food.settlement_unitprice"}})],1),n("td",[n("el-input",{staticStyle:{width:"50%"},attrs:{placeholder:"请输入数量",readonly:t.readonly},on:{input:function(e){o.settlement_count=t.formatNum(o.settlement_count,2)}},model:{value:o.settlement_count,callback:function(e){t.$set(o,"settlement_count",e)},expression:"food.settlement_count"}})],1),n("td",[t._v(t._s(t.positiveFloat(t.positiveFloatSix(o.settlement_unitprice)*t.positiveFloat(o.settlement_count))))]),n("td",[t._v(t._s(o.settlement_customer_objection))]),n("td",[n("el-input",{class:{difference:t.foodDifference(o),line:!o.quoted_price_food_id},attrs:{readonly:t.readonly},model:{value:o.settlement_comments,callback:function(e){t.$set(o,"settlement_comments",e)},expression:"food.settlement_comments"}}),!o.quoted_price_food_id&&t.issubmit?n("el-button",{attrs:{icon:"el-icon-delete",type:"danger",circle:"",size:"mini"},on:{click:function(n){return t.delfood(e,i)}}}):t._e()],1)])}))],2)})),t.foodVisible?n("tbody",[n("tr",{staticClass:"color_2"},[n("th",{staticClass:"color_3"},[t._v("杂费小计")]),n("th",{staticClass:"color_3"}),n("th",{staticClass:"color_3"}),n("th",{staticClass:"color_3"}),n("th"),n("th"),n("th",{staticStyle:{"text-align":"right"}},[t._v("¥"+t._s(t.positiveFloat(t.foodPrice[2]*t.foodSettlementOut)))]),n("th"),n("th",[t.issubmit?n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addOther(3)}}},[t._v("添加杂费")]):t._e()],1)]),t._l(t.foodincidental,(function(e){return n("tr",{key:e.id},[n("td",{staticClass:"color_2"},[n("el-input",{attrs:{readonly:t.readonly,placeholder:"杂费项名称"},model:{value:e.content,callback:function(n){t.$set(e,"content",n)},expression:"foodzf.content"}})],1),n("td",{staticClass:"color_2"}),n("td",{staticClass:"color_2"}),n("td",{staticClass:"color_2"}),n("td",[n("el-input",{attrs:{type:"text",readonly:t.readonly},on:{input:function(n){e.price=t.formatNum(e.price,2)}},model:{value:e.price,callback:function(n){t.$set(e,"price",n)},expression:"foodzf.price"}})],1),n("td",[n("el-input",{attrs:{readonly:t.readonly},on:{input:function(n){e.count=t.positiveFloatOne(e.count)}},model:{value:e.count,callback:function(n){t.$set(e,"count",n)},expression:"foodzf.count"}})],1),n("td",[t._v(t._s(t.positiveFloat(t.positiveFloatSix(e.price)*t.positiveFloat(e.count))))]),n("td",{staticClass:"color_2"}),n("td",[n("el-input",{staticClass:"line",attrs:{readonly:t.readonly},model:{value:e.comments,callback:function(n){t.$set(e,"comments",n)},expression:"foodzf.comments"}}),t.issubmit?n("el-button",{attrs:{icon:"el-icon-delete",type:"danger",circle:"",size:"mini"},on:{click:function(n){return t.delOther(e.id)}}}):t._e()],1)])}))],2):t._e()],2),n("div",{staticClass:"qita"},[n("div",{staticClass:"left"},[n("div",{staticClass:"stitle"},[t._v("客户异议")]),n("div",{staticClass:"context"},[t._v(t._s(t.info.settlement_customer_objection))])]),n("div",{staticClass:"right"},[n("div",{staticClass:"stitle"},[t._v("其他说明")]),n("div",{staticClass:"context"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.info.settlement_offer_remarks,expression:"info.settlement_offer_remarks"}],domProps:{value:t.info.settlement_offer_remarks},on:{input:function(e){e.target.composing||t.$set(t.info,"settlement_offer_remarks",e.target.value)}}})])])])]):t._e(),n("div",{staticClass:"excel"},[n("a",{attrs:{download:""},on:{click:t.excelDownload}},[t._v("导出结算单")])]),n("div",{staticClass:"submit"},[["0020-1","0020-4","0020-7","0020-8"].includes(this.info.orderstatus)?n("el-button",{on:{click:t.draft}},[t._v("保存到草稿箱")]):t._e(),["0020-4","0020-7","0020-8"].includes(this.info.orderstatus)?n("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("提交结算单")]):t._e()],1),t.info.historylist&&t.info.historylist.length>0?n("div",{staticClass:"info"},[n("el-card",{staticClass:"box-card"},[n("div",{staticClass:"header clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[t._v("历史结算单：")])]),t._l(t.info.historylist,(function(e,o){return n("div",{key:e.id,staticClass:"text item"},[t._v(" 第"+t._s(o+1)+"次结算, 总价￥"+t._s(t.positiveFloat(e.settlement_total_price))+"元，[ "+t._s(t._f("date_ex")(e.submit_time))+" ] ")])}))],2)],1):t._e(),n("el-dialog",{attrs:{visible:t.addSettleShow,title:"添加结算项目",center:"",width:"600px"},on:{"update:visible":function(e){t.addSettleShow=e},close:function(e){t.addSettleShow=!1}}},[n("el-form",{ref:"addSettleInfo",attrs:{model:t.addSettleInfo,rules:t.addSettleRules,"label-width":"200px"}},[n("el-form-item",{attrs:{label:"选择项目分类",prop:"projectClass"}},[n("el-select",{staticClass:"demand_300",attrs:{size:"small",clearable:"",filterable:""},on:{change:t.changeProjectClass},model:{value:t.addSettleInfo.projectClass,callback:function(e){t.$set(t.addSettleInfo,"projectClass",e)},expression:"addSettleInfo.projectClass"}},t._l(t.projectClass,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),n("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.needCostDate,expression:"needCostDate"}],attrs:{label:"选择费用发生日期",prop:"costDate"}},[n("el-select",{staticClass:"demand_300",attrs:{size:"small",clearable:"",filterable:""},model:{value:t.addSettleInfo.costDate,callback:function(e){t.$set(t.addSettleInfo,"costDate",e)},expression:"addSettleInfo.costDate"}},t._l(t.costDates,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),n("el-form-item",{attrs:{label:"选择费用项目",prop:"costProject"}},[n("el-select",{staticClass:"demand_300",attrs:{loading:t.cost_project_load,size:"small",clearable:"",filterable:""},on:{change:t.changecostProject},model:{value:t.addSettleInfo.costProject,callback:function(e){t.$set(t.addSettleInfo,"costProject",e)},expression:"addSettleInfo.costProject"}},t._l(t.costProjects,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),n("span",{staticClass:"dialog-footer flex_row justify_center",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"small"},on:{click:function(e){t.addSettleShow=!1}}},[t._v("取 消")]),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.addSettle}},[t._v("添 加")])],1)],1)],1):t._e()},i=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("thead",[n("tr",{staticClass:"color_2"},[n("th",[t._v("凭证名称")]),n("th",[t._v("文件")]),n("th",[t._v("客户异议")]),n("th",[t._v("说明")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("th",{staticClass:"color_3"},[n("i",{staticStyle:{color:"#428bca"}},[t._v("客房")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("th",{staticClass:"color_3"},[n("i",{staticStyle:{color:"#428bca"}},[t._v("会场")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("tr",{staticClass:"color_2"},[n("th",{staticClass:"color_3"},[t._v("消费项目")]),n("th",{staticClass:"color_3"},[t._v("单价(元)")]),n("th",{staticClass:"color_3"},[t._v("数量")]),n("th",{staticClass:"color_3"},[t._v("金额(元)")]),n("th",[t._v("单价(元)")]),n("th",[t._v("数量")]),n("th",[t._v("金额(元)")]),n("th",[t._v("客户异议")]),n("th",[t._v("结算说明")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("th",{staticClass:"color_3"},[n("i",{staticStyle:{color:"#428bca"}},[t._v("餐饮")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("tr",{staticClass:"color_2"},[n("th",{staticClass:"color_3"},[t._v("消费项目")]),n("th",{staticClass:"color_3"},[t._v("单价(元)")]),n("th",{staticClass:"color_3"},[t._v("数量")]),n("th",{staticClass:"color_3"},[t._v("金额(元)")]),n("th",[t._v("单价(元)")]),n("th",[t._v("数量")]),n("th",[t._v("金额(元)")]),n("th",[t._v("客户异议")]),n("th",[t._v("结算说明")])])}],s=n("2909"),a=n("1da1"),r=(n("96cf"),n("4de4"),n("d3b7"),n("159b"),n("b0c0"),n("d81d"),n("ac1f"),n("5319"),n("caad"),n("a630"),n("3ca3"),n("fb6a"),n("a434"),n("4e82"),n("cf45")),c=n("0e5c"),l=n("c1df"),f=n.n(l),u=n("df68"),m=n("acd6"),d=(n("b587"),{data:function(){return{info:null,fileList:[],fileList2:[],fileList3:[],fileList4:[],fileList5:[],status_draft:"0029-1",status_tobeconfirmed:"0029-2",status_confirm:"0029-3",status_supplement:"0029-5",status_reject:"0029-4",settlement_status:"0029-3",errormsg:[],quoted_price_food_option:[{value:0,label:"酒店内用餐"},{value:1,label:"酒店外用餐"}],orderIDList:[],roomOut:1,roomSettlementOut:1,roomOutMsg:"",conferenceOut:1,conferenceSettlementOut:1,conferenceOutMsg:"",foodOut:1,foodSettlementOut:1,foodOutMsg:"",transportationOut:1,transportationOutMsg:"",carOut:1,carOutMsg:"",otherOut:1,otherOutMsg:"",arrayList:[{type:1,fileList:[],name:"酒店住宿发票+小联",remark:"",dissent:""},{type:2,fileList:[],name:"酒店餐饮发票+小联",remark:"",dissent:""},{type:3,fileList:[],name:"酒店会场发票+小联",remark:"",dissent:""},{type:4,fileList:[],name:"其他",remark:"",dissent:""},{type:5,fileList:[],name:"供应商发票及账单",remark:"",dissent:""}],updateIndex:0,updateFileIndex:0,rename:!1,fileName:"",suffix:"",downloadUrl:"",addSettleShow:!1,projectClass:[{value:"0034",label:"客房"},{value:"0049",label:"会场"},{value:"0050",label:"酒店内餐饮"}],costDates:[],roomcostProjects:[],meetingcostProjects:[],costProjefoodcostProjectscts:[],cost_project_load:!1,costProjects:[],addSettleRules:{projectClass:[{required:!0,message:"请选择项目分类",trigger:"change"}],costDate:[{required:!0,message:"请选择费用发生日期",trigger:"change"}],costProject:[{required:!0,message:"请选择费用项目",trigger:"change"}]},addSettleInfo:{projectClass:"0034",costDate:"",costProject:""},needCostDate:!0}},computed:{issubmit:function(){return 1==this.$route.params.issubmit},readonly:function(){return 0==this.$route.params.issubmit},isconfirm:function(){return this.info.settlement_status==this.status_confirm},issupplement:function(){return this.info.settlement_status==this.status_supplement},formateDate:function(){return function(t){return Object(r["d"])("YYYY年mm月dd日",new Date(t))}},roomVisible:function(){return this.info.settlement_sheet_room&&this.info.settlement_sheet_room.length>0},conferenceVisible:function(){return this.info.settlement_sheet_conference&&this.info.settlement_sheet_conference.length>0},foodVisible:function(){return this.info.settlement_sheet_food&&this.info.settlement_sheet_food.length>0},transportationVisible:function(){return this.info.settlement_sheet_transportation&&this.info.settlement_sheet_transportation.length>0},carVisible:function(){return this.info.settlement_sheet_car&&this.info.settlement_sheet_car.length>0},roomincidental:function(){return this.info.settlement_sheet_sundries.filter((function(t){return 1==t.type}))},meetingcidental:function(){return this.info.settlement_sheet_sundries.filter((function(t){return 2==t.type}))},foodincidental:function(){return this.info.settlement_sheet_sundries.filter((function(t){return 3==t.type}))},intercitytrafficincidental:function(){return this.info.settlement_sheet_sundries.filter((function(t){return 4==t.type}))},carincidental:function(){return this.info.settlement_sheet_sundries.filter((function(t){return 5==t.type}))},otherincidental:function(){return this.info.settlement_sheet_sundries.filter((function(t){return 6==t.type}))},roomPrice:function(){var t=this,e=[{all:0,subtotal:{}},{all:0,subtotal:{}},0],n=e[0].subtotal,o=e[1].subtotal;return this.info.settlement_sheet_room.forEach((function(i,s){n["sub_".concat(s)]||(n["sub_".concat(s)]=0),o["sub_".concat(s)]||(o["sub_".concat(s)]=0),i.room_list.forEach((function(i){n["sub_".concat(s)]+=Object(r["o"])(i.totalprice),e[0].all+=Object(r["o"])(i.totalprice);var a=0;a=0==t.info.is_Inside_outside?i.settlement_count:Object(r["m"])(i.settlement_inside_roomcount)+Object(r["m"])(i.settlement_outside_roomcount),o["sub_".concat(s)]+=Object(r["o"])(i.settlement_unitprice)*Object(r["m"])(a),e[1].all+=Object(r["o"])(i.settlement_unitprice)*Object(r["m"])(a)}))})),this.roomincidental.forEach((function(t){e[1].all+=+Object(r["o"])(t.price)*Object(r["m"])(t.count),e[2]+=Object(r["o"])(t.price)*Object(r["m"])(t.count)})),e},adddifferenceerrormsg:function(){return function(t,e,n){var o="";1==t?o=this.formateDate(e)+"客房,第"+n+"行,单价(元)或数量存在差异,请填写结算说明":2==t?o=this.formateDate(e)+"会场,第"+n+"行,单价(元)或数量存在差异,请填写结算说明":3==t?o=this.formateDate(e)+"餐饮,第"+n+"行,单价(元)或数量存在差异,请填写结算说明":4==t?o=this.formateDate(e)+"大交通,第"+n+"行,单价(元)或数量存在差异,请填写结算说明":5==t?o=this.formateDate(e)+"地面交通,第"+n+"行,单价(元)或数量存在差异,请填写结算说明":6==t&&(o="其他服务,第"+n+"行,单价(元)或数量存在差异,请填写结算说明"),this.errormsg.push(o)}},addnewitemerrormsg:function(){return function(t,e,n){var o="";1==t?o=this.formateDate(e)+"新增客房,第"+n+"行,消费项目名称为必填项,请填写消费项目名称":2==t?o=this.formateDate(e)+"新增会场,第"+n+"行,消费项目名称为必填项,请填写消费项目名称":3==t?o=this.formateDate(e)+"新增餐饮,第"+n+"行,消费项目名称为必填项,请填写消费项目名称":4==t?o=this.formateDate(e)+"新增大交通,第"+n+"行,消费项目名称为必填项,请填写消费项目名称":5==t&&(o=this.formateDate(e)+"新增地面交通,第"+n+"行,消费项目名称为必填项,请填写消费项目名称"),this.errormsg.push(o)}},addnewitemhasnocommments:function(){return function(t,e,n){var o="";1==t?o=this.formateDate(e)+"新增客房,第"+n+"行,结算说明为必填项,请填写结算说明":2==t?o=this.formateDate(e)+"新增会场,第"+n+"行,结算说明为必填项,请填写结算说明":3==t?o=this.formateDate(e)+"新增餐饮,第"+n+"行,结算说明为必填项,请填写结算说明":4==t?o=this.formateDate(e)+"新增大交通,第"+n+"行,结算说明为必填项,请填写结算说明":5==t&&(o=this.formateDate(e)+"新增地面交通,第"+n+"行,结算说明为必填项,请填写结算说明"),this.errormsg.push(o)}},roomDifference:function(){return function(t){return Object(r["o"])(t.unitprice)!==Object(r["o"])(t.settlement_unitprice)||Object(r["m"])(t.provide_count)!==Object(r["m"])(t.settlement_count)||!t.quoted_price_room_id&&""==t.settlement_comments}},checkRoomDifference:function(){var t=this,e=!1;this.info.settlement_sheet_room&&this.info.settlement_sheet_room.length>0&&this.info.settlement_sheet_room.forEach((function(n){if(n.room_list&&n.room_list.length>0){n.room_list.forEach((function(o,i){e=t.roomDifference(o),!e||null==o.quoted_price_room_id||null!=o.settlement_comments&&""!=o.settlement_comments||t.adddifferenceerrormsg(1,n.date,i+1),!e||null!=o.quoted_price_room_id||null!=o.settlement_comments&&""!=o.settlement_comments||t.addnewitemhasnocommments(1,n.date,i+1)}));var o=n.room_list.filter((function(t){return null==t.quoted_price_room_id&&""==t.settlement_itemname}));o.length>0&&o.forEach((function(e,o){t.addnewitemerrormsg(1,n.date,o+1)}))}}))},conferencePrice:function(){var t=[{all:0,subtotal:{}},{all:0,subtotal:{}},0],e=t[0].subtotal,n=t[1].subtotal;return this.info.settlement_sheet_conference.forEach((function(o,i){e["sub_".concat(i)]||(e["sub_".concat(i)]=0),n["sub_".concat(i)]||(n["sub_".concat(i)]=0),o.conference_list.forEach((function(o){var s=Object(r["o"])(o.price)*Object(r["m"])(o.count),a=Object(r["o"])(o.settlement_price)*Object(r["m"])(o.settlement_count);e["sub_".concat(i)]+=s,t[0].all+=s,n["sub_".concat(i)]+=a,t[1].all+=a}))})),this.meetingcidental.forEach((function(e){var n=Object(r["o"])(e.price)*Object(r["m"])(e.count);t[1].all+=n,t[2]+=n})),t},conferenceDifference:function(){return function(t){return Object(r["o"])(t.price)!==Object(r["o"])(t.settlement_price)||Object(r["m"])(t.count)!==Object(r["m"])(t.settlement_count)||!t.quoted_price_conference_id&&""==t.settlement_comments}},checkConferenceDifference:function(){var t=this,e=!1;this.info.settlement_sheet_conference&&this.info.settlement_sheet_conference.length>0&&this.info.settlement_sheet_conference.forEach((function(n){if(n.conference_list&&n.conference_list.length>0){n.conference_list.forEach((function(o,i){e=t.conferenceDifference(o),!e||null==o.quoted_price_conference_id||null!=o.settlement_comments&&""!=o.settlement_comments||t.adddifferenceerrormsg(2,n.date,i+1),!e||null!=o.quoted_price_conference_id||null!=o.settlement_comments&&""!=o.settlement_comments||t.addnewitemhasnocommments(2,n.date,i+1)}));var o=n.conference_list.filter((function(t){return null==t.quoted_price_conference_id&&""==t.settlement_itemname}));o.length>0&&o.forEach((function(e,o){t.addnewitemerrormsg(2,n.date,o+1)}))}}))},foodPrice:function(){var t=[{all:0,subtotal:{}},{all:0,subtotal:{}},0],e=t[0].subtotal,n=t[1].subtotal;return this.info.settlement_sheet_food.forEach((function(o,i){e["sub_".concat(i)]||(e["sub_".concat(i)]=0),n["sub_".concat(i)]||(n["sub_".concat(i)]=0),o.food_list.forEach((function(o){var s=Object(r["o"])(o.price)*Object(r["m"])(o.personcount),a=Object(r["o"])(o.settlement_unitprice)*Object(r["m"])(o.settlement_count);e["sub_".concat(i)]+=s,t[0].all+=s,n["sub_".concat(i)]+=a,t[1].all+=a}))})),this.foodincidental.forEach((function(e){var n=Object(r["o"])(e.price)*Object(r["m"])(e.count);t[1].all+=n,t[2]+=n})),t},foodDifference:function(){return function(t){return Object(r["o"])(t.price)!==Object(r["o"])(t.settlement_unitprice)||Object(r["m"])(t.personcount)!==Object(r["m"])(t.settlement_count)||!t.quoted_price_food_id&&""==t.settlement_comments}},checkFoodDifference:function(){var t=this,e=!1;this.info.settlement_sheet_food&&this.info.settlement_sheet_food.length>0&&this.info.settlement_sheet_food.forEach((function(n){if(n.food_list&&n.food_list.length>0){n.food_list.forEach((function(o,i){e=t.foodDifference(o),!e||null==o.quoted_price_food_id||null!=o.settlement_comments&&""!=o.settlement_comments||t.adddifferenceerrormsg(3,n.date,i+1),!e||null!=o.quoted_price_food_id||null!=o.settlement_comments&&""!=o.settlement_comments||t.addnewitemhasnocommments(3,n.date,i+1)}));var o=n.food_list.filter((function(t){return null==t.quoted_price_food_id&&""==t.settlement_itemname}));o.length>0&&o.forEach((function(e,o){t.addnewitemerrormsg(3,n.date,o+1)}))}}))},intercitytrafficPrice:function(){var t=[{all:0,subtotal:{}},{all:0,subtotal:{}},0],e=t[0].subtotal,n=t[1].subtotal;return this.info.settlement_sheet_transportation.forEach((function(o,i){e["sub_".concat(i)]||(e["sub_".concat(i)]=0),n["sub_".concat(i)]||(n["sub_".concat(i)]=0),o.transportation_list.forEach((function(o){var s=Object(r["o"])(o.unitprice)*Object(r["m"])(o.passengercount),a=Object(r["o"])(o.settlement_unitprice)*Object(r["m"])(o.settlement_count);e["sub_".concat(i)]+=s,t[0].all+=s,n["sub_".concat(i)]+=a,t[1].all+=a}))})),this.intercitytrafficincidental.forEach((function(e){var n=Object(r["o"])(e.price)*Object(r["m"])(e.count);t[1].all+=n,t[2]+=n})),t},transportationDifference:function(){return function(t){return Object(r["o"])(t.unitprice)!==Object(r["o"])(t.settlement_unitprice)||Object(r["m"])(t.passengercount)!==Object(r["m"])(t.settlement_count)||!t.quoted_price_transportation_id&&""==t.settlement_comments}},checkTransportationDifference:function(){var t=this,e=!1;this.info.settlement_sheet_transportation&&this.info.settlement_sheet_transportation.length>0&&this.info.settlement_sheet_transportation.forEach((function(n){if(n.transportation_list&&n.transportation_list.length>0){n.transportation_list.forEach((function(o,i){e=t.transportationDifference(o),!e||null==o.quoted_price_transportation_id||null!=o.settlement_comments&&""!=o.settlement_comments||t.adddifferenceerrormsg(4,n.date,i+1),!e||null!=o.quoted_price_transportation_id||null!=o.settlement_comments&&""!=o.settlement_comments||t.addnewitemhasnocommments(4,n.date,i+1)}));var o=n.transportation_list.filter((function(t){return null==t.quoted_price_transportation_id&&""==t.settlement_itemname}));o.length>0&&o.forEach((function(e,o){t.addnewitemerrormsg(5,n.date,o+1)}))}}))},carPrice:function(){var t=[{all:0,subtotal:{}},{all:0,subtotal:{}},0],e=t[0].subtotal,n=t[1].subtotal;return this.info.settlement_sheet_car.forEach((function(o,i){e["sub_".concat(i)]||(e["sub_".concat(i)]=0),n["sub_".concat(i)]||(n["sub_".concat(i)]=0),o.car_list.forEach((function(o){var s=Object(r["o"])(o.price)*Object(r["m"])(o.carcount),a=Object(r["o"])(o.settlement_unitprice)*Object(r["m"])(o.settlement_count);e["sub_".concat(i)]+=s,t[0].all+=s,n["sub_".concat(i)]+=a,t[1].all+=a}))})),this.carincidental.forEach((function(e){var n=Object(r["o"])(e.price)*Object(r["m"])(e.count);t[1].all+=n,t[2]+=n})),t},carDifference:function(){return function(t){return Object(r["o"])(t.price)!==Object(r["o"])(t.settlement_unitprice)||Object(r["m"])(t.carcount)!==Object(r["m"])(t.settlement_count)||!t.quoted_price_car_id&&""==t.settlement_comments}},checkCarDifference:function(){var t=this,e=!1;this.info.settlement_sheet_car&&this.info.settlement_sheet_car.length>0&&this.info.settlement_sheet_car.forEach((function(n){if(n.car_list&&n.car_list.length>0){n.car_list.forEach((function(o,i){e=t.carDifference(o),!e||null==o.quoted_price_car_id||null!=o.settlement_comments&&""!=o.settlement_comments||t.adddifferenceerrormsg(5,n.date,i+1),!e||null!=o.quoted_price_car_id||null!=o.settlement_comments&&""!=o.settlement_comments||t.addnewitemhasnocommments(5,n.date,i+1)}));var o=n.car_list.filter((function(t){return null==t.quoted_price_car_id&&""==t.settlement_itemname}));o.length>0&&o.forEach((function(e,o){t.addnewitemerrormsg(4,n.date,o+1)}))}}))},otherPrice:function(){var t=[0,0,0];return this.info.settlement_sheet_other.forEach((function(e,n){var o=Object(r["o"])(e.price)*Object(r["m"])(e.offerservicedaycount)*Object(r["m"])(e.offerparticipatecount),i=Object(r["o"])(e.settlement_unitprice)*Object(r["m"])(e.settlement_count);t[0]=t[0]+o,t[1]=t[1]+i})),this.otherincidental.forEach((function(e){var n=Object(r["o"])(e.price)*Object(r["m"])(e.count);t[1]=t[1]+n,t[2]=t[2]+n})),t},otherDifference:function(){return function(t){return Object(r["o"])(t.price)!==Object(r["o"])(t.settlement_unitprice)||Object(r["m"])(t.offerservicedaycount)*Object(r["m"])(t.offerparticipatecount)!==Object(r["m"])(t.settlement_count)||!t.quoted_price_other_id&&""==t.settlement_comments}},checkOtherDifference:function(){var t=this,e=!1;this.info.settlement_sheet_other&&this.info.settlement_sheet_other.length>0&&this.info.settlement_sheet_other.forEach((function(n,o){e=t.otherDifference(n),!e||null!=n.settlement_comments&&""!=n.settlement_comments||t.adddifferenceerrormsg(6,null,o+1)}))},servicePrice:function(){var t=[0,0];return t[0]=Object(r["o"])(this.info.advance_amount)*Object(r["o"])(this.info.advance_proportion/100)+Object(r["o"])(this.info.travelagency_payment_money)*Object(r["o"])(this.info.travelagency_payment_proportion/100)+Object(r["o"])(this.info.off_hotel_expenses)*Object(r["o"])(this.info.off_hotel_proportion/100),t[1]=Object(r["o"])(Object(r["o"])(this.info.settlement_advance_amount)*this.info.settlement_advance_proportion/100)+this.InTheHotelMoney*Object(r["o"])(this.info.settlement_travelagency_payment_proportion/100)+this.OutsideTheHotelMoney*Object(r["o"])(this.info.settlement_off_hotel_proportion/100),this.info.feizhicai_service=t[1],this.info.taxation=0,t},price_no:function(){var t=[0,0];return t[0]=this.roomPrice[0].all*this.roomOut+this.conferencePrice[0].all*this.conferenceOut+this.foodPrice[0].all*this.foodOut,t[1]=this.roomPrice[1].all*this.roomSettlementOut+this.conferencePrice[1].all*this.conferenceSettlementOut+this.foodPrice[1].all*this.foodSettlementOut,this.info.settlement_total_amount=t[1]||0,t},price:function(){var t=[0,0];return t[0]=this.price_no[0]+this.servicePrice[0]+Object(r["o"])((this.price_no[0]+this.servicePrice[0])*Object(r["m"])(this.info.taxrate)/100),this.info.settlement_total_amount=this.price_no[1]+this.servicePrice[1]+Object(r["o"])((this.price_no[1]+this.servicePrice[1])*Object(r["m"])(this.info.settlement_taxrate)/100),t[1]=this.info.settlement_total_amount,t},InTheHotelMoney:function(){var t=0;this.info.settlement_sheet_food.forEach((function(e){e.food_list.forEach((function(e){0==e.addresstype&&(t+=Object(r["o"])(e.settlement_unitprice)*Object(r["m"])(e.settlement_count))}))}));var e=0;return this.foodincidental.forEach((function(t){var n=Object(r["o"])(t.price)*Object(r["m"])(t.count);t.isnotservice||(e+=n)})),this.roomPrice[1].all+this.conferencePrice[1].all+t+e},OutsideTheHotelMoney:function(){var t=0;this.info.settlement_sheet_food.forEach((function(e){e.food_list.forEach((function(e){1==e.addresstype&&(t+=Object(r["o"])(e.settlement_unitprice)*Object(r["m"])(e.settlement_count))}))}));var e=0;this.info.settlement_sheet_other.forEach((function(t){1!=t.islocalguide&&(e+=Object(r["o"])(t.settlement_unitprice)*Object(r["m"])(t.settlement_count))}));var n=0;return this.otherincidental.forEach((function(t){var e=Object(r["o"])(t.price)*Object(r["m"])(t.count);t.isnotservice||(n+=e)})),this.intercitytrafficincidental.forEach((function(t){var e=Object(r["o"])(t.price)*Object(r["m"])(t.count);t.isnotservice||(n+=e)})),this.foodincidental.forEach((function(t){var e=Object(r["o"])(t.price)*Object(r["m"])(t.count);t.isnotservice&&(n+=e)})),this.intercitytrafficPrice[1].all-this.intercitytrafficPrice[2]+this.carPrice[1].all+t+e+n}},methods:{guid:r["k"],positiveInteger:r["q"],positiveFloat:r["m"],positiveFloatOne:r["n"],positiveFloatSix:r["o"],formatNum:r["e"],excelExport:m["a"],limitsEffect:u["a"],changekefang:function(t,e){var n=this.roomcostProjects.filter((function(e){return e.code==t}));e.settlement_itemname=n[0].name},changehuichang:function(t,e){var n=this.meetingcostProjects.filter((function(e){return e.code==t}));e.settlement_itemname=n[0].name},changehotelnei:function(t,e){var n=this.foodcostProjects.filter((function(e){return e.code==t}));e.settlement_itemname=n[0].name},openAddSettle:function(){var t=this;this.cost_project_load=!0;var e=f()(this.info.event_startdate).subtract(3,"days").format("YYYY-MM-DD"),n=f()(this.info.event_enddate).add(1,"days").format("YYYY-MM-DD"),o=Object(r["f"])(e,n);this.costDates=[],o.forEach((function(e,n){t.costDates.push({value:e,label:e})})),this.changeProjectClass(),this.addSettleShow=!0},changecostProject:function(){"zafei"==this.addSettleInfo.costProject?(this.needCostDate=!1,this.addSettleRules.costDate[0].required=!1):(this.needCostDate=!0,this.addSettleRules.costDate[0].required=!0)},changeProjectClass:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={"0034":{selects:"roomcostProjects"},"0049":{selects:"meetingcostProjects"},"0050":{selects:"foodcostProjects"}},"009"==t.addSettleInfo.projectClass?t.needCostDate=!1:t.needCostDate=!0,t.cost_project_load=!0,e.next=5,t.$api.getCostProjects({code:t.addSettleInfo.projectClass},"POST");case 5:o=e.sent,t.cost_project_load=!1,t[n[t.addSettleInfo.projectClass].selects]=o.map((function(t){return t.value=t.code,t.label=t.name,t})),t.costProjects=o.map((function(t){return t.value=t.code,t.label=t.name,t})),t.costProjects.push({label:"杂费",value:"zafei"}),t.addSettleInfo.costProject=t.costProjects[0].value;case 11:case"end":return e.stop()}}),e)})))()},initCostProject:function(){var t=this;this.$api.getCostProjects({code:""},"POST").then((function(e){var n=e.filter((function(t){return"0034"==t.event_dictionary_code})),o=e.filter((function(t){return"0049"==t.event_dictionary_code})),i=e.filter((function(t){return"0050"==t.event_dictionary_code})),s=e.filter((function(t){return"0051"==t.event_dictionary_code})),a=e.filter((function(t){return"003"==t.event_dictionary_code})),r=e.filter((function(t){return"006"==t.event_dictionary_code})),c=e.filter((function(t){return"009"==t.event_dictionary_code}));t.roomcostProjects=n.map((function(t){return t.label=t.name,t.value=t.code,t})),t.meetingcostProjects=o.map((function(t){return t.label=t.name,t.value=t.code,t})),t.foodcostProjects=i.map((function(t){return t.label=t.name,t.value=t.code,t})),t.otherfoodcostProjects=s.map((function(t){return t.label=t.name,t.value=t.code,t})),t.transportationcostProjects=a.map((function(t){return t.label=t.name,t.value=t.code,t})),t.carcostProjects=r.map((function(t){return t.label=t.name,t.value=t.code,t})),t.othercostProjects=c.map((function(t){return t.label=t.name,t.value=t.code,t}))}))},addSettle:function(){var t=this,e={"0034":{dataList:"roomlist",addBusinessBlock:"addroomBusiness",addDataBlock:"addroom",selects:"roomcostProjects"},"0049":{dataList:"conferencelist",addBusinessBlock:"addconferenceBusiness",addDataBlock:"addconference",selects:"meetingcostProjects"},"0050":{dataList:"foodlist",addBusinessBlock:"addfoodBusiness",addDataBlock:"addfood",selects:"foodcostProjects"}},n={"0034":1,"0049":2,"0050":3,"0051":7,"003":4,"006":5,"009":6};this.$refs.addSettleInfo.validate((function(o){if(o){var i=e[t.addSettleInfo.projectClass];if(i)if(t[i.selects]=Object(s["a"])(t.costProjects),"zafei"==t.addSettleInfo.costProject)t.addOther(n[t.addSettleInfo.projectClass]);else if(t.info[i.dataList]&&t.info[i.dataList].length)if("009"==t.addSettleInfo.projectClass)t[i.addDataBlock](filterDate[0],!0);else{var a=t.info[i.dataList].filter((function(e){return t.addSettleInfo.costDate==f()(e.date).format("YYYY-MM-DD")}));a&&a.length?t[i.addDataBlock](a[0],!0):t[i.addBusinessBlock](!0)}else t[i.addBusinessBlock](!0);t.addSettleShow=!1}}))},excelDownload:function(){this.orderIDList.push(this.info.orderform_id);var t="结算单"+this.info.num;this.excelExport("/SettlementSheet/ExportExcel1",{orderIDList:this.orderIDList},t)},handleChangeAttach:function(t,e,n){var o=this,i=t.size/1024/1024<30;if(this.limitsEffect(t)){if(!i)return this.$message.error("上传附件大小不能超过 30MB!"),void this.arrayList.forEach((function(i,s){n==i.type&&o.$refs.upload[s].handleRemove(t,e,n)}));this.arrayList.forEach((function(t,o){n==t.type&&(t.fileList=e)})),this.initFileRename()}else this.arrayList.forEach((function(i,s){n==i.type&&o.$refs.upload[s].handleRemove(t,e,n)}))},handleRemoveAttach:function(t,e,n){this.arrayList.forEach((function(t,o){n==t.type&&(t.fileList=e)})),this.initFileRename()},handlePreview:function(t){var e=this;if(t.url){var n=t.url.substring(t.url.lastIndexOf(".")+1),o=["pdf","jpeg","jpg","png","txt"],i=["docx","doc","xls","xlsx","xlsm","ppt","pptx"];t.url=t.url.replace(/http:/,"https:"),this.downloadUrl=t.url,i.includes(n)?this.downloadUrl="https://view.officeapps.live.com/op/view.aspx?src="+encodeURIComponent(t.url):o.includes(n)?this.downloadUrl=t.url:this.$message.info("文件格式不支持预览，下载后查看"),setTimeout((function(){e.$refs.a_click.click()}),100)}},initFileRename:function(){var t=this;this.$nextTick((function(){var e=document.getElementsByClassName("el-upload-list__item-name")||null;Array.from(e).forEach((function(e,n,o){var i=e.innerText;e.getElementsByTagName("span")[0]||(e.innerHTML+="<span style='color:#199ED8;cursor: pointer;'>重命名</span>"),e.getElementsByTagName("span")[0].addEventListener("click",(function(n){n.stopPropagation(),t.rename=!0,t.fileName=i.slice(0,i.lastIndexOf(".")),t.suffix=i.slice(i.lastIndexOf(".")),console.log(e.getElementsByTagName("span")[0].parentNode.parentNode.parentNode)}))}))}))},fileRename:function(t,e,n){this.rename=!0,this.updateIndex=e,this.updateFileIndex=n,this.fileName=t.name.slice(0,t.name.lastIndexOf(".")),this.suffix=t.name.slice(t.name.lastIndexOf("."))},saveFileName:function(){var t=this;if(this.arrayList[this.updateIndex].fileList[this.updateFileIndex].name=this.fileName+this.suffix,this.info.settlement_sheet_attach.forEach((function(e,n){e.id==t.arrayList[t.updateIndex].fileList[t.updateFileIndex].id&&(t.info.settlement_sheet_attach[n].filename=t.fileName+t.suffix)})),this.arrayList[this.updateIndex].fileList[this.updateFileIndex].raw){var e=new File([this.arrayList[this.updateIndex].fileList[this.updateFileIndex].raw],this.fileName+this.suffix,{lastModified:this.arrayList[this.updateIndex].fileList[this.updateFileIndex].raw.lastModified,lastModifiedDate:this.arrayList[this.updateIndex].fileList[this.updateFileIndex].raw.lastModifiedDate,type:this.arrayList[this.updateIndex].fileList[this.updateFileIndex].raw.type});this.arrayList[this.updateIndex].fileList[this.updateFileIndex].raw=e}this.rename=!1},deleteFile:function(t,e,n){this.arrayList[e].fileList.splice(n,1)},addOther:function(t){this.info.settlement_sheet_sundries.push({id:this.guid(),type:t,price:0,count:0,comments:"",content:"",isnotservice:!1})},delOther:function(t){this.info.settlement_sheet_sundries=this.info.settlement_sheet_sundries.filter((function(e){return e.id!=t}))},addroom:function(t,e){var n=this;return Object(a["a"])(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(e){o.next=4;break}return n.addSettleInfo.projectClass="0034",o.next=4,n.changeProjectClass();case 4:t.room_list.push({settlement_itemid:n.addSettleInfo.costProject,roomtypename:"",totalprice:0,unitprice:0,roomcount:0,inside_roomcount:0,settlement_inside_roomcount:0,outside_roomcount:0,settlement_outside_roomcount:0,settlement_unitprice:"0",settlement_itemname:n.findCostProjectByKey(n.addSettleInfo.costProject).label,settlement_count:"0",settlement_comments:""});case 5:case"end":return o.stop()}}),o)})))()},findCostProjectByKey:function(t){var e=this.costProjects.filter((function(e){return t==e.value}));return e&&e.length?e[0]:null},addroomBusiness:function(t){this.info.settlement_sheet_room.push({date:f()(this.addSettleInfo.costDate).format("YYYY/MM/DD"),room_list:[{settlement_itemid:this.addSettleInfo.costProject,roomtypename:"",totalprice:0,unitprice:0,roomcount:0,inside_roomcount:0,settlement_inside_roomcount:0,outside_roomcount:0,settlement_outside_roomcount:0,settlement_unitprice:"0",settlement_itemname:this.findCostProjectByKey(this.addSettleInfo.costProject).label,settlement_count:"0",settlement_comments:""}]}),this.info.settlement_sheet_room=this.info.settlement_sheet_room.sort((function(t,e){return new Date(t.date).getTime()-new Date(e.date).getTime()}))},delroom:function(t,e){t.room_list.splice(e,1)},addconference:function(t,e){var n=this;return Object(a["a"])(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(e){o.next=4;break}return n.addSettleInfo.projectClass="0049",o.next=4,n.changeProjectClass();case 4:t.conference_list.push({settlement_itemid:n.addSettleInfo.costProject,is_important:"",price:0,count:0,settlement_price:"0",settlement_itemname:n.findCostProjectByKey(n.addSettleInfo.costProject).label,settlement_count:"1",settlement_comments:""});case 5:case"end":return o.stop()}}),o)})))()},addconferenceBusiness:function(t){this.info.settlement_sheet_conference.push({date:f()(this.addSettleInfo.costDate).format("YYYY/MM/DD"),conference_list:[{settlement_itemid:this.addSettleInfo.costProject,is_important:"",price:0,count:0,settlement_price:"0",settlement_itemname:this.findCostProjectByKey(this.addSettleInfo.costProject).label,settlement_count:"1",settlement_comments:""}]}),this.info.settlement_sheet_conference=this.info.settlement_sheet_conference.sort((function(t,e){return new Date(t.date).getTime()-new Date(e.date).getTime()}))},delconference:function(t,e){t.conference_list.splice(e,1)},addfood:function(t,e){var n=this;return Object(a["a"])(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(e){o.next=4;break}return n.addSettleInfo.projectClass="0050",o.next=4,n.changeProjectClass();case 4:t.food_list.push({settlement_itemid:n.addSettleInfo.costProject,foodtypename:"",addresstype:"0",personcount:0,price:0,settlement_unitprice:"0",settlement_itemname:n.findCostProjectByKey(n.addSettleInfo.costProject).label,settlement_count:"0",settlement_comments:""});case 5:case"end":return o.stop()}}),o)})))()},addfoodBusiness:function(t){this.info.settlement_sheet_food.push({date:f()(this.addSettleInfo.costDate).format("YYYY/MM/DD"),food_list:[{settlement_itemid:this.addSettleInfo.costProject,foodtypename:"",addresstype:"0",personcount:0,price:0,settlement_unitprice:"0",settlement_itemname:this.findCostProjectByKey(this.addSettleInfo.costProject).label,settlement_count:"0",settlement_comments:""}]}),this.info.settlement_sheet_food=this.info.settlement_sheet_food.sort((function(t,e){return new Date(t.date).getTime()-new Date(e.date).getTime()}))},delfood:function(t,e){t.food_list.splice(e,1)},addstransportation:function(t){t.transportation_list.push({joinname:"",passengercount:0,unitprice:0,settlement_unitprice:"0",settlement_itemname:"",settlement_count:"0",settlement_comments:""})},delstransportation:function(t,e){t.transportation_list.splice(e,1)},addcar:function(t){t.car_list.push({purposename:"",carcount:0,price:0,settlement_unitprice:"0",settlement_itemname:"",settlement_count:"0",settlement_comments:""})},delcar:function(t,e){t.car_list.splice(e,1)},submit:function(){this.validate()&&(this.arrayList[0].fileList.length||this.arrayList[1].fileList.length||this.arrayList[2].fileList.length||this.arrayList[3].fileList.length?(this.info.settlement_status!=this.status_confirm&&(this.info.settlement_status=this.status_tobeconfirmed),this.save()):this.$message.error("请上传酒店住宿发票+小联、酒店餐饮发票+小联、酒店会场发票+小联、其他"))},draft:function(){this.validate()&&(this.arrayList[0].fileList.length||this.arrayList[1].fileList.length||this.arrayList[2].fileList.length||this.arrayList[3].fileList.length?(this.info.settlement_status=this.status_draft,this.save()):this.$message.error("请上传酒店住宿发票+小联、酒店餐饮发票+小联、酒店会场发票+小联、其他"))},differenceShowErrorMessage:function(){var t="";this.errormsg.forEach((function(e){t+="<p style='padding:5px;'>"+e+"</p>"})),this.$message({message:t,dangerouslyUseHTMLString:!0,type:"error",lockScroll:!1})},validate:function(){return this.errormsg=[],this.checkRoomDifference,this.checkConferenceDifference,this.checkFoodDifference,this.checkTransportationDifference,this.checkCarDifference,this.checkOtherDifference,this.errormsg.length>0&&this.differenceShowErrorMessage(),0==this.errormsg.length},save:function(){var t=this;this.info.pre_settlement_status===this.status_reject&&(this.info.settlement_sheet_id=null),this.info.settlement_voucher=this.arrayList[0].remark,this.info.settlement_contract=this.arrayList[1].remark,this.info.settlement_waterbill=this.arrayList[2].remark,this.info.settlement_other=this.arrayList[3].remark,this.info.settlement_invoice=this.arrayList[4].remark;var e=[{urLs:[]},{urLs:[]},{urLs:[]},{urLs:[]},{urLs:[]}];e.forEach((function(e,n){if(t.arrayList[n]){t.arrayList[n].fileList.filter((function(t){return""!=t.uid}));t.arrayList[n].fileList.length>0&&t.arrayList[n].fileList.forEach((function(t){e.urLs.push({key:t.uid,file:t.raw})}))}})),Object(c["a"])(e[0].urLs).then((function(n){return t.info.settlement_sheet_attach&&t.info.settlement_sheet_attach.length>0&&t.info.settlement_sheet_attach.forEach((function(e){0==t.arrayList[0].fileList.filter((function(t){return t.id==e.id})).length&&e.filetype==t.arrayList[0].type&&(e.delete=!0)})),n.forEach((function(e){e&&t.info.settlement_sheet_attach.push({filetype:t.arrayList[0].type,filepath:e.FilePath,filename:e.OriginalFileName})})),Object(c["a"])(e[1].urLs)})).then((function(n){return t.info.settlement_sheet_attach&&t.info.settlement_sheet_attach.length>0&&t.info.settlement_sheet_attach.forEach((function(e){0==t.arrayList[1].fileList.filter((function(t){return t.id==e.id})).length&&e.filetype==t.arrayList[1].type&&(e.delete=!0)})),n.forEach((function(e){e&&t.info.settlement_sheet_attach.push({filetype:t.arrayList[1].type,filepath:e.FilePath,filename:e.OriginalFileName})})),Object(c["a"])(e[2].urLs)})).then((function(n){return t.info.settlement_sheet_attach&&t.info.settlement_sheet_attach.length>0&&t.info.settlement_sheet_attach.forEach((function(e){0==t.arrayList[2].fileList.filter((function(t){return t.id==e.id})).length&&e.filetype==t.arrayList[2].type&&(e.delete=!0)})),n.forEach((function(e){e&&t.info.settlement_sheet_attach.push({filetype:t.arrayList[2].type,filepath:e.FilePath,filename:e.OriginalFileName})})),Object(c["a"])(e[3].urLs)})).then((function(n){return t.info.settlement_sheet_attach&&t.info.settlement_sheet_attach.length>0&&t.info.settlement_sheet_attach.forEach((function(e){0==t.arrayList[3].fileList.filter((function(t){return t.id==e.id})).length&&e.filetype==t.arrayList[3].type&&(e.delete=!0)})),n.forEach((function(e){e&&t.info.settlement_sheet_attach.push({filetype:t.arrayList[3].type,filepath:e.FilePath,filename:e.OriginalFileName})})),Object(c["a"])(e[4].urLs)})).then((function(e){return t.info.settlement_sheet_attach&&t.info.settlement_sheet_attach.length>0&&t.info.settlement_sheet_attach.forEach((function(e){0==t.arrayList[4].fileList.filter((function(t){return t.id==e.id})).length&&e.filetype==t.arrayList[4].type&&(e.delete=!0)})),e.forEach((function(e){e&&t.info.settlement_sheet_attach.push({filetype:t.arrayList[4].type,filepath:e.FilePath,filename:e.OriginalFileName})})),t.info.settlement_sheet_room&&t.info.settlement_sheet_room.forEach((function(t){for(var e=0;e<t.room_list.length;e++)t.room_list[e].indexs=e+1})),t.info.settlement_sheet_conference&&t.info.settlement_sheet_conference.forEach((function(t){for(var e=0;e<t.conference_list.length;e++)t.conference_list[e].indexs=e+1})),t.info.settlement_sheet_food&&t.info.settlement_sheet_food.forEach((function(t){for(var e=0;e<t.food_list.length;e++)t.food_list[e].indexs=e+1})),t.$api.settlementsheetSave(t.info,"POST")})).then((function(e){e?(t.$message({message:"保存成功！",type:"success"}),t.$router.push({name:"orderInfo_Hotel",params:{id:t.info.orderform_id}})):t.$message({message:"保存失败！",type:"error"})}))},initVat:function(){var t=this;this.info.taxlist.forEach((function(e,n){e.id==t.info.roomtaxid&&(t.roomOut=e.outtaxrate,t.roomOutMsg=e.taxname),e.id==t.info.conferencetaxid&&(t.conferenceOut=e.outtaxrate,t.conferenceOutMsg=e.taxname),e.id==t.info.foodtaxid&&(t.foodOut=e.outtaxrate,t.foodOutMsg=e.taxname),e.id==t.info.settlement_roomtaxid&&(t.roomSettlementOut=e.outtaxrate),e.id==t.info.settlement_conferencetaxid&&(t.conferenceSettlementOut=e.outtaxrate),e.id==t.info.settlement_foodtaxid&&(t.foodSettlementOut=e.outtaxrate)}))},roomVat:function(t){var e=this;this.info.taxlist.forEach((function(n,o){n.id==t&&(e.roomSettlementOut=n.outtaxrate)})),this.info.roomtaxid=t},conferenceVat:function(t){var e=this;this.info.taxlist.forEach((function(n,o){n.id==t&&(e.conferenceSettlementOut=n.outtaxrate)})),this.info.conferencetaxid=t},foodVat:function(t){var e=this;this.info.taxlist.forEach((function(n,o){n.id==t&&(e.foodSettlementOut=n.outtaxrate)})),this.info.foodtaxid=t},initInfo:function(){var t=this;this.info.settlement_sheet_room.forEach((function(e,n){e.room_list.forEach((function(e){e.settlement_sheet_room_id||(e.settlement_unitprice=Object(r["o"])(e.unitprice),"0"==t.info.is_Inside_outside&&(e.settlement_count=e.provide_count,e.settlement_inside_roomcount=0,e.settlement_outside_roomcount=e.provide_count),"1"==t.info.is_Inside_outside&&(e.settlement_count=e.provide_count,e.settlement_inside_roomcount=e.inside_roomcount,e.settlement_outside_roomcount=e.outside_roomcount))}))})),this.info.settlement_sheet_conference.forEach((function(t,e){t.conference_list.forEach((function(t){t.settlement_sheet_conference_id||(t.settlement_price=Object(r["o"])(t.price),t.settlement_count=Object(r["m"])(t.count))}))})),this.info.settlement_sheet_food.forEach((function(t,e){t.food_list.forEach((function(t){t.settlement_sheet_food_id||(t.settlement_unitprice=Object(r["o"])(t.price),t.settlement_count=Object(r["m"])(t.personcount))}))}))}},mounted:function(){var t=this;this.initCostProject(),this.$api.settlementsheetInfo({id:this.$route.params.id},"POST").then((function(e){t.info=e,t.initVat(),t.initInfo(),t.info.settlement_sheet_attach&&t.info.settlement_sheet_attach.length>0&&t.info.settlement_sheet_attach.forEach((function(e){t.arrayList.forEach((function(n,o){e.filetype==n.type&&t.arrayList[o].fileList.push({id:e.id,uid:"",name:e.filename,url:t.info.domain+e.filepath})}))})),t.arrayList[0].remark=t.info.settlement_voucher,t.arrayList[1].remark=t.info.settlement_contract,t.arrayList[2].remark=t.info.settlement_waterbill,t.arrayList[3].remark=t.info.settlement_other,t.arrayList[4].remark=t.info.settlement_invoice,t.info.dissent_invoice&&(t.arrayList[0].dissent=t.info.dissent_voucher,t.arrayList[1].dissent=t.info.dissent_contract,t.arrayList[2].dissent=t.info.dissent_waterbill,t.arrayList[3].dissent=t.info.dissent_other,t.arrayList[4].dissent=t.info.dissent_invoice),t.initFileRename()}))}}),_=d,h=(n("1fbd"),n("2877")),p=Object(h["a"])(_,o,i,!1,null,"42c0da02",null);e["default"]=p.exports}}]);