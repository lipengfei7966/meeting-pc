(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-288fc8b3"],{2613:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=this,i=e.$createElement,s=e._self._c||i;return s("div",{staticClass:"orderInfo"},[s("div",{staticClass:"title"},[e._v(" 我的订单 - "),e.info?[e._v(" "+e._s(e.info.num)+" ")]:e._e()],2),e.info?s("div",{staticClass:"content"},["0020-1"===this.info.status?s("div",{staticClass:"tips"},[s("p",[e._v("订单状态：订单执行中")]),s("p",[e._v(" 会议进行中，请实时上传结算凭证文件！ ")]),s("p",[s("el-button",{attrs:{type:"primary"},on:{click:e.settlement}},[e._v(" "+e._s(e.info.settlement_sheet_status===e.settlement_sheet_status_draft?"提交结算单(草稿)":"提交结算单")+" ")])],1)]):e._e(),"0020-3"===this.info.status?s("div",{staticClass:"tips"},[s("p",[e._v("订单状态：已创建待执行")]),s("p",[e._v(" 请查看以下订单详情，如果客户需要使用会议室等场地，请为客户预留档期。 ")]),s("p",{staticClass:"special"},[s("span",[e._v("如果您遇到特殊情况需要取消订单，可以点击")]),s("el-link",{staticClass:"special_link",attrs:{name:"cancel",type:"primary"},on:{click:e.cancelorderform}},[e._v("取消订单")]),s("span",[e._v("并说明原委，我们将同时为您发送短信和邮件向客户致歉。")])],1)]):"0020-2"===this.info.status?s("div",{staticClass:"tips"},[s("p",[e._v("订单状态：已取消")]),s("p",[e._v(" "+e._s(e.info.contacts)+" - "+e._s(e.info.company_name)+" - 取消了订单 ("+e._s(e.info.activity_name)+") ")])]):"0020-4"===this.info.status?s("div",{staticClass:"tips"},[s("p",[e._v("订单状态：已执行待结算")]),s("p",[e._v(" 会议服务商服务已经结束，请向客户提交结算单。结算单被确认后，您可以快递发票和结算单，以便客户付款。 ")]),s("p",[s("el-button",{attrs:{type:"primary"},on:{click:e.settlement}},[e._v(" "+e._s(e.info.settlement_sheet_status===e.settlement_sheet_status_draft?"提交结算单(草稿)":"提交结算单")+" ")])],1)]):"0020-5"===this.info.status?s("div",{staticClass:"tips"},[s("p",[e._v("订单状态：待确认结算单")]),s("p",{staticClass:"special"},[s("span",[e._v("已提交结算单，正在等待客户确认。 如果客户长时间未确认，您可以")]),s("el-link",{staticClass:"special_link",attrs:{name:"remind",type:"primary"},on:{click:e.againform}},[e._v("再次提醒客户")]),s("span",[e._v("。")])],1),s("p",[s("el-button",{attrs:{type:"primary"},on:{click:e.settlement}},[e._v("查看结算单")])],1)]):"0020-6"===this.info.status?s("div",{staticClass:"tips"},[s("p",[e._v("订单状态：已确认结算单")]),s("p",[e._v(" 客户确认了您的结算单，您可以与客户沟通发票、付款的事宜。 ")])]):"0020-7"===this.info.status?s("div",{staticClass:"tips"},[s("p",[e._v("订单状态：客户驳回结算单")]),s("p",[e._v(" 客户对结算单有异议，请查看、修改后重新移交结算单。 ")]),this.info.orderform_settlement_customer_objection?s("p",[e._v(" 客户异议："+e._s(this.info.orderform_settlement_customer_objection)+" ")]):e._e(),s("p",[s("el-button",{attrs:{type:"primary"},on:{click:e.settlement}},[e._v("提交结算单")])],1)]):"0020-8"===this.info.status?s("div",{staticClass:"tips"},[s("p",[e._v("订单状态：要求补充结算单材料")]),s("p",[e._v(" 客户对结算单有异议，请查看、修改后重新移交结算单。 ")]),this.info.orderform_settlement_customer_objection?s("p",[e._v(" 客户异议："+e._s(this.info.orderform_settlement_customer_objection)+" ")]):e._e(),s("p",[s("el-button",{attrs:{type:"primary"},on:{click:e.settlement}},[e._v("提交结算单")])],1)]):e._e(),s("div",{staticClass:"info"},[s("div",{staticClass:"line"},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("订单号")]),s("div",{staticClass:"context"},[e._v(e._s(e.info.num))])]),s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("联系人")]),s("div",{staticClass:"context"},[e._v(e._s(e.info.contacts))])])]),s("div",{staticClass:"line"},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("下单时间")]),s("div",{staticClass:"context"},[e._v(e._s(e._f("date_ex")(e.info.submit_time)))])]),s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("联系方式")]),s("div",{staticClass:"context"},[e._v(e._s(e.info.customer_service_telephone_numbers))])])]),s("div",{staticClass:"line"},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("活动名称")]),s("div",{staticClass:"context"},[e._v(e._s(e.info.activity_name))])]),s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("客户名称")]),s("div",{staticClass:"context"},[e._v(e._s(e.info.company_name))])])]),s("div",{staticClass:"line"},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("活动日期")]),s("div",{staticClass:"context"},[e._v(e._s(e.info.activity_date))])]),s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("报价日期")]),s("div",{staticClass:"context"},[e._v(e._s(e._f("date_ex")(e.info.offer_data)))])])])]),s("div",{staticClass:"info"},[s("div",{staticClass:"line"},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("报价人")]),s("div",{staticClass:"context"},[e._v(e._s(e.info.bidder))])]),s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("报价时间")]),s("div",{staticClass:"context"},[e._v(" "+e._s(e._f("date_ex")(e.info.offer_data))+" ")])])])]),s("div",{staticClass:"info"},[s("div",{staticClass:"line"},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("历史附件")]),s("div",{staticClass:"context"},[s("p",[e._v("客户已通过邮件发送该订单的 “询价单” 至以下人员：")]),s("p",[e._v(e._s(e.info.mailbox))]),s("p",[s("el-button",{attrs:{type:"primary"},on:{click:e.quotedprice}},[e._v("最终报价单")]),"0020-6"===this.info.status?s("el-button",{attrs:{type:"primary"},on:{click:e.settlement}},[e._v("结算单 ")]):e._e()],1)])])])]),s("div",{staticClass:"info"},[s("div",{staticClass:"line"},[s("div",{staticClass:"item"},[s("div",{staticClass:"label need",staticStyle:{width:"100%"}},[e._v(" 客户需求 "),s("div",{staticClass:"excel"},[s("a",{staticStyle:{cursor:"pointer"},on:{click:e.excelexport}},[e._v("下载excel")])])])])]),s("div",{staticClass:"line"},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("客房需求")]),s("div",{staticClass:"context"},[e._l(e.info.quoted_price_room,(function(t){return s("div",{key:t.id,staticClass:"hyxq_item"},[s("div",{staticClass:"date"},[e._v(" 日期："+e._s(e._f("date_day")(t.date))+" 客房价格 ")]),e._l(t.room_list,(function(t){return s("div",{key:t.id,staticClass:"c_item"},[e._v(" "+e._s(t.roomtypename)+" "+e._s(t.roomcount)+"间 "),s("span",{staticClass:"quotedprice"},[e._v("报价：￥"+e._s(t.unitprice.toFixed(2))+"*"+e._s(t.provide_count)+"间 ￥"+e._s(t.totalprice.toFixed(2)))]),s("p",[e._v("报价备注："+e._s(t.remarks))])])}))],2)})),s("br"),s("br"),e._v(" 客房报价总备注："+e._s(e.info.room_remarks)+" "),s("br"),e._v(" 客房报价小计："),s("span",{staticClass:"quotedprice"},[e._v("￥"+e._s(this.allMoney.toFixed(2)))])],2)]),s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("会议需求")]),s("div",{staticClass:"context"},[e._l(e.info.quoted_price_conference,(function(t){return s("div",{key:t.id,staticClass:"hyxq_item"},[s("div",{staticClass:"date"},[e._v(" 日期："+e._s(e._f("date_day")(t.date))+" ")]),e._l(t.conference_list,(function(i){return s("div",{key:i.id,staticClass:"c_item"},[1==i.type?s("div",[e._v(" "+e._s(i.item)+" "+e._s(i.starttime)+"-"+e._s(i.endtime)+" "+e._s(i.roomsetuptypename)+" "+e._s(i.attendees)+" 人，会场面积范围："+e._s(i.min_area)+"~"+e._s(i.max_area)+" sqm "),s("div",{staticClass:"quotedprice"},[e._v(" 报价：￥"+e._s(i.price.toFixed(2))+" 备注:"+e._s(i.describe)+" ")])]):2==i.type?s("div",[e._v(" "+e._s(i.item+i.typename)+" "+e._s(e._f("date_day")(t.date))+" "+e._s(i.starttime)+"~"+e._s(e._f("date_day")(t.date))+" "+e._s(i.endtime)+" "+e._s(i.related_information)+" "),s("div",{staticClass:"quotedprice"},[e._v(" 报价：￥"+e._s(i.price.toFixed(2))+" ")])]):3==i.type?s("div",[e._v(" "+e._s(i.item+i.typename)+" "),s("span",{staticClass:"quotedprice"},[e._v("报价：￥"+e._s(i.price.toFixed(2))+" ")]),e._v(" "+e._s(i.equipment)+" 备注："+e._s(i.microphonedescribe)+" ")]):4==i.type?s("div",[s("p",[e._v(e._s(i.item+i.order_name+i.quoted_name)+": "+e._s(i.equipment))]),s("p",[s("span",{staticClass:"quotedprice"},[e._v("报价：￥"+e._s(i.price.toFixed(2))+" ")])]),s("p",[e._v("报价备注："+e._s(i.comments))])]):e._e()])}))],2)})),s("br"),s("br"),e._v(" 会场报价总备注："+e._s(e.info.conference_remarks)+" "),s("div",{staticClass:"quotedpricesum"},[e._v("会场报价小计"),s("span",{staticClass:"quotedprice"},[e._v("￥"+e._s((this.EquipmentMoney+this.meetingMoney).toFixed(2)))])])],2)])]),s("div",{staticClass:"line"},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("用餐需求")]),s("div",{staticClass:"context"},[e._l(e.info.quoted_price_food,(function(t){return s("div",{key:t.id,staticClass:"hyxq_item"},[s("div",{staticClass:"date"},[e._v(" 日期："+e._s(e._f("date_day")(t.date))+" ")]),e._l(t.food_list,(function(t){return s("div",{key:t.id,staticClass:"c_item"},[s("span",[e._v(e._s(t.foodtypename))]),e._v(" "+e._s(t.usetype?"["+t.usetype+"]":"")+" "+e._s(t.personcount)+" 人 "),s("p",{staticClass:"quotedprice"},[e._v("报价：￥"+e._s(t.price.toFixed(2))+"*"+e._s(t.personcount)+" 人 ￥"+e._s((t.price*t.personcount).toFixed(2))+" 备注："+e._s(t.offer_remarks))])])}))],2)})),s("br"),s("br"),s("div",{staticClass:"quotedpricesum"},[e._v("餐饮报价小计："),s("span",{staticClass:"quotedprice"},[e._v("￥"+e._s(this.repastAllMoney.toFixed(2)))])])],2)])]),s("div",{staticClass:"line"},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[e._v("总报价")]),s("div",{staticClass:"context"},[s("span",{staticClass:"quotedprice"},[e._v("￥"+e._s(this.OrderPrice.toFixed(2)))])])])])]),s("el-dialog",{attrs:{title:"添加项目",visible:e.addProjectStatus,"before-close":function(e){t.itemData=null,e()},width:"700px"},on:{"update:visible":function(t){e.addProjectStatus=t}}},[e.addProjectStatus?s("projectAdded",{attrs:{"item-data":e.itemData},on:{onColse:e.projectSave}}):e._e()],1)],1):e._e()])},o=[],n=(i("d3b7"),i("159b"),i("4de4"),i("97aa")),a=i("cf45"),c=(i("bc3a"),i("acd6")),r={name:"OrderInfo",components:{projectAdded:n["a"]},data:function(){return{info:null,addProjectStatus:!1,itemData:null,settlement_sheet_status_draft:"0029-1",excelAddress:""}},computed:{dayMoney:function(){return function(t){var e=this,i=0;return t.forEach((function(t){i+=e.positiveInteger(t.provide_count)*e.positiveFloat(t.unitprice)})),this.positiveFloat(i)}},allMoney:function(){var t=this,e=0;return this.info.quoted_price_room&&this.info.quoted_price_room.length>0&&this.info.quoted_price_room.forEach((function(i){e+=t.positiveFloat(t.dayMoney(i.room_list))})),this.positiveFloat(e)},meetingDayMoney:function(){return function(t,e){var i=this,s=0;return t.forEach((function(t){s+=i.positiveFloat(t.price)})),this.positiveFloat(s)}},meetingMoney:function(){var t=this,e=0;return this.info.quoted_price_conference&&this.info.quoted_price_conference.length>0&&this.info.quoted_price_conference.forEach((function(i){var s=i.conference_list.filter((function(t){return 3!=t.type}));e+=t.meetingDayMoney(s)})),this.positiveFloat(e)},EquipmentMoney:function(){var t=this,e=0;return this.info.quoted_price_conference&&this.info.quoted_price_conference.length>0&&this.info.quoted_price_conference.forEach((function(i){var s=i.conference_list.filter((function(t){return 3==t.type}));e+=t.meetingDayMoney(s)})),this.positiveFloat(e)},meetingAllMoney:function(){var t=this,e=0;return this.info.quoted_price_conference&&this.info.quoted_price_conference.length>0&&this.info.quoted_price_conference.forEach((function(i){e+=t.meetingDayMoney(i.conference_list)})),this.positiveFloat(e)},repastDayMoney:function(){return function(t){var e=this,i=0;return t.forEach((function(t){i+=e.positiveInteger(t.personcount)*e.positiveFloat(t.price)})),this.positiveFloat(i)}},repastAllMoney:function(){var t=this,e=0;return this.info.quoted_price_food&&this.info.quoted_price_food.length>0&&this.info.quoted_price_food.forEach((function(i){e+=t.repastDayMoney(i.food_list)})),this.positiveFloat(e)},IntercityTransportationDayMoney:function(){return function(t){var e=this,i=0;return t.forEach((function(t){i+=e.positiveInteger(t.passengercount)*e.positiveFloat(t.unitprice)})),this.positiveFloat(i)}},IntercityTransportationAllMoney:function(){var t=this,e=0;return this.info.quoted_price_transportation&&this.info.quoted_price_transportation.length>0&&this.info.quoted_price_transportation.forEach((function(i){e+=t.IntercityTransportationDayMoney(i.transportation_list)})),this.positiveFloat(e)},CityDayMoney:function(){return function(t){var e=this,i=0;return t.forEach((function(t){i+=e.positiveInteger(t.carcount)*e.positiveFloat(t.price)})),this.positiveFloat(i)}},CityAllMoney:function(){var t=this,e=0;return this.info.quoted_price_car&&this.info.quoted_price_car.length>0&&this.info.quoted_price_car.forEach((function(i){e+=t.CityDayMoney(i.car_list)})),this.positiveFloat(e)},otherAllMoney:function(){var t=this,e=0;return this.info.quoted_price_other&&this.info.quoted_price_other.length>0&&this.info.quoted_price_other.forEach((function(i){e+=t.positiveInteger(i.offerparticipatecount)*t.positiveInteger(i.offerservicedaycount)*t.positiveFloat(i.price)})),this.positiveFloat(e)},money:function(){return this.info.total_price=Object(a["q"])(this.allMoney)+Object(a["q"])(this.meetingAllMoney)+Object(a["q"])(this.repastAllMoney)+Object(a["q"])(this.IntercityTransportationAllMoney)+Object(a["q"])(this.CityAllMoney)+Object(a["q"])(this.otherAllMoney),Object(a["m"])(this.info.total_price)},TravelAgencyMoney:function(){return this.positiveFloat(this.info.travelagency_payment_money*this.info.travelagency_payment_proportion/100)},AdvancesMoney:function(){return Object(a["m"])(this.positiveFloat(this.info.advance_amount)*(this.positiveFloat(this.info.advance_proportion)/100))},OutsideHotelMoney:function(){return this.positiveFloat(this.info.off_hotel_expenses*this.info.off_hotel_proportion/100)},serviceAllMoney:function(){return Object(a["m"])(this.TravelAgencyMoney+this.AdvancesMoney+this.OutsideHotelMoney)},Taxes:function(){return"VAT"==this.info.taxtype?Object(a["m"])((this.money+this.serviceAllMoney)*this.positiveInteger(this.info.taxrate)/100):0*(this.money+this.serviceAllMoney)},OrderPrice:function(){return Object(a["m"])(this.money+this.serviceAllMoney+this.Taxes)}},methods:{positiveInteger:a["q"],positiveFloat:a["m"],excelExport:c["a"],excelexport:function(){var t="订单"+this.info.inquiry_sheet_code;this.excelExport("/orderform/exportexcel",{id:this.$route.params.id},t)},project:function(){this.info.project_id?this.$router.push({name:"ItineraryManagement",params:{id:this.info.project_id}}):this.addProjectStatus=!0},projectSave:function(t){var e=this;this.$api.projectsave(t,"POST").then((function(i){e.$message({message:t.id?"修改成功！":"添加成功！",type:"success"}),e.$router.push({name:"ItineraryManagement",params:{id:e.info.project_id}})}))},quotedprice:function(){var t=this.$router.resolve({name:"quotedprice",params:{id:this.info.quoted_price_id,isSubmit:0}});window.open(t.href,"_blank")},settlement:function(){var t=this.$route.params.id,e=1;this.info.settlement_sheet_status===this.settlement_sheet_status_draft&&(t=this.info.settlement_sheet_id),"0020-5"!==this.info.status&&"0020-6"!==this.info.status&&"0020-8"!==this.info.status||(t=this.info.settlement_sheet_id,e=0),0==this.info.serviceprovider_or_hotel?this.$router.push({name:"settleAccounts_Hotel",params:{id:t,issubmit:e}}):this.$router.push({name:"settleAccounts",params:{id:t,issubmit:e}})},cancelorderform:function(){var t=this;this.$prompt("请简要说明取消订单的原因","拒绝接单",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea"}).then((function(e){var i=e.value;t.$api.cancelorderform({id:t.info.orderform_id,object_id:t.info.object_id,reason:i},"POST").then((function(e){e?(t.$message({message:"订单已取消",type:"success"}),t.$router.go(0)):t.$message({message:"订单取消失败",type:"fail"})}))})).catch((function(){}))},againform:function(){var t=this;this.$api.againform({id:this.info.orderform_id,object_id:this.info.object_id},"POST").then((function(e){e?t.$message({message:"提醒成功",type:"success"}):t.$message({message:"提醒失败",type:"fail"})}))}},mounted:function(){var t=this;this.$api.orderInfo({id:this.$route.params.id},"POST").then((function(e){t.info=e}))}},l=r,_=(i("50f2"),i("2877")),d=Object(_["a"])(l,s,o,!1,null,"0e3f7042",null);e["default"]=d.exports},"50f2":function(t,e,i){"use strict";i("ba3f")},acd6:function(t,e,i){"use strict";i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),i("9861");var s=i("bc3a"),o=i.n(s),n=i("f121"),a=n["b"];e["a"]=function(t,e,i){return new Promise((function(s,n){var c=function(){"/Template/GetTemplate"==t?o()({method:"post",url:a+t,data:e,headers:{"Content-Type":"application/json;charset=utf-8"}}).then((function(t){var s=document.createElement("a"),o=t.data.path.substring(t.data.path.lastIndexOf("."));fetch(t.data.path).then((function(t){return t.blob()})).then((function(t){s.href=URL.createObjectURL(t),console.log(s.href),5==e.type||e.type,s.download=i+o,document.body.appendChild(s),s.click()}))})):o()({method:"post",url:a+t,data:e,responseType:"blob",headers:{"Content-Type":"application/json;charset=utf-8"}}).then((function(s){console.log(s);var o=s.data,n=new FileReader;n.readAsDataURL(o),n.onload=function(s){var o=document.createElement("a");o.style.display="none","/quotation/exportexcel"==t||"/SettlementSheet/ExportExcel1"==t||"/orderform/exportexcel"==t||"/Quotation/ExportExcel"==t?o.download=i+".xls":"/Template/GetTemplate"==t?5==e.type||6==e.type?o.download=i+".docx":o.download=i+".xls":"/Reporting/GetExcel"==t&&(o.download=i+".xls"),o.href=s.target.result;document.body;document.body.appendChild(o),o.click(),document.body.removeChild(o)}}))};c()}))}},ba3f:function(t,e,i){}}]);